<!DOCTYPE html>
<html lang="fr-fr">
	<head>
		<meta charset="utf-8">
		<title>NodeAtlas</title>

		<base href="">

		<meta name="description" content="NodeAtlas est un Framework JavaScript MVC(2) côté serveur.">
		<meta name="geo.placename" content="Annecy, Haute-Savoie, France">

		<meta name="robots" content="index, follow">

		<!--[if IE]><meta name="viewport" content="width=device-width, user-scalable=no" /><![endif]-->
		<!--[if !IE]><!--><meta name="viewport" content="initial-scale=1.0, user-scalable=no"><!--<![endif]-->

		<!-- Inclusion du fichiers minifié après génération. -->
		
		<link rel="stylesheet" href="stylesheets/common.min.css">
		
		<!-- Inclusion du fichiers standar pendant le développement. -->
		
	</head>
	<body data-content="content/" data-subpath="/NodeAtlas">
		<div class="layout">
			<noscript class="no-js cmpt">
				<div class="no-js--inner">
					<p>Le JavaScript n'est pas activé.</p>
				</div>
			</noscript>
			<div class="background"></div>
			<header class="header cmpt">
				<div class="header--inner">
					<div class="header--title">
						<h1>
							<img class="header--title--node" src="media/images/min/ode.png" alt="Node">
							<img class="header--title--atlas" src="media/images/min/tlas.png" alt="Atlas">
						</h1>
					</div>
					<div class="header--abstract">
						<p>Le Framework JavaScript Serveur MVC(2)</p>
					</div>
					<div class="header--main">
						<ul>
							<li>
								<div class="header--main--first">
									<h2><span>Mise en place</span> <strong>Simple</strong></h2>
									<p>Au point avec <strong>HTML &amp; CSS</strong> ?<br><strong>Débutant</strong> en JavaScript ?</p>
									<p class="small">Réalisez rapidement des sites vitrines multilingues sans effort avec de simple Routes, Views ou Variations.</p>
								</div>
							</li>
							<li>
								<div class="header--main--second">
									<h2><span>Sites vivant et</span> <strong>Évolutif</strong></h2>
									<p><strong>Expert</strong> en JavaScript client ?<br>Prêt à embrasser <strong>Node.js</strong> ?</p>
									<p class="small">Améliorer progressivement votre base à mesure de vos besoins en utilisant des Controllers, Modèles ou Modules.</p>
								</div>
							</li>
							<li>
								<div class="header--main--third">
									<h2><span>Partie Cliente</span> <strong>Agnostique</strong></h2>
									<p>Déjà vos habitudes <strong>Front-end</strong> ?<br>Habitué(e) du <strong>Data Binding</strong> ?</p>
									<p class="small">Du léger Vanilla JS au simple jQuery en passant par Vue, Angular ou React : utiliser vos outils clients favoris !</p>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</header>
			<aside class="download cmpt">
				<div class="download--inner">
					Download
				</div>
			</aside>
			<nav class="navigation cmpt">
				<div class="navigation--outer">
					<div class="navigation--start"><button>Commencez</button></div>
					<div class="navigation--documentation"><button>Documentation</button></div>
				</div>
				<div class="navigation--inner">
					<div class="navigation--lang">
						<a href="english/index.html" title="English">English</a>
					</div>
					<div class="navigation--home">
						<a href="index.html" title="Accueil"><img src="media/images/logo.png" alt="Accueil" width="80px"> Accueil</a>
					</div>
					<div class="navigation--menu">
						<ul>
							
							<li>
								<a href="avant-propos.html" title="Présentation">Présentation</a>
								
								<ul>
									
									<li>
										<a href="installation.html" title="Installation">Installation</a>
									</li>
									
									<li>
										<a href="commencer-avec-nodeatlas.html" title="Démarrage rapide">Démarrage rapide</a>
									</li>
									
								</ul>
								
							</li>
							
							<li>
								<a href="cr%C3%A9ation-de-site-partie-front-end.html" title="View et Template">View et Template</a>
								
							</li>
							
							<li>
								<a href="d%C3%A9veloppement-javascript-partie-back-end.html" title="Controller et Model">Controller et Model</a>
								
							</li>
							
							<li>
								<a href="pour-aller-plus-loin.html" title="Route et Plus">Route et Plus</a>
								
								<ul>
									
									<li>
										<a href="api-nodeatlas-comme-module-npm.html" title="API">API</a>
									</li>
									
									<li>
										<a href="cli-commandes-de-lancement.html" title="CLI">CLI</a>
									</li>
									
									<li>
										<a href="nodeatlas-comme-simple-serveur-web.html" title="Simple Serveur">Simple Serveur</a>
									</li>
									
									<li>
										<a href="faire-tourner-nodeatlas-sur-serveur.html" title="Autres Serveurs">Autres Serveurs</a>
									</li>
									
								</ul>
								
							</li>
							
							<li>
								<a href="plus-sur-nodeatlas.html" title="Et les autres ?">Et les autres ?</a>
								
							</li>
							
						</ul>
					</div>
				</div>
			</nav>
			<nav class="content cmpt">
				<div class="content--inner">
					<h2 id="faire-tourner-nodeatlas-sur-serveur">Faire tourner NodeAtlas sur serveur</h2><h3 id="dans-un-environnement-windows-server-avec-iisnode">Dans un environnement Windows Server avec iisnode</h3><p>Dans un environnement Windows Server 2013 avec IIS8 il faut :</p><ol>
<li>Installer <a href="http://nodejs.org/download/">l’exécutable node.exe</a> capable d’exécuter du code JavaScript.</li>
<li>Installer <a href="http://www.iis.net/downloads/microsoft/url-rewrite">le module IIS8 UrlRewrite</a> pour mapper les pages exécutées à une Url de sortie.</li>
<li>Installer <a href="https://github.com/tjanczuk/iisnode/downloads">le module IIS8 issnode</a> pour lire des web.config et manager des site via IIS (Management de pool d’application, démarrage/arrêt de site, etc...).</li>
</ol><h4 id="cr-er-une-application">Créer une application</h4><p>Dans IIS8, créez un Website et créez une Application.</p><p>Le contenu de votre application sera celui du site mélangé à celui de NodeAtlas. Cela signifie donc que ceci :</p><pre><code>node-atlas/
— node_modules/
— languages/
—— default.json
— node-atlas.js
site-hello-world/
— assets/
— templates/
—— index.htm
— webconfig.json
</code></pre><p>devient ceci :</p><pre><code>site-hello-world/
— node_modules/
— languages/
—— default.json
— assets/
— templates/
—— index.htm
— node-atlas.js
— webconfig.json
</code></pre><p>Vous rajouterez à cet ensemble de fichiers, un fichier supplémentaire nommé <code>web.config</code> dont le contenu est le suivant :</p><pre><code class="lang-xml">&lt;configuration&gt;
    &lt;system.webServer&gt;
        &lt;handlers&gt;
            &lt;add name=&quot;iisnode&quot; path=&quot;node-atlas.js&quot; verb=&quot;*&quot; modules=&quot;iisnode&quot; /&gt;
        &lt;/handlers&gt;
        &lt;rewrite&gt;
            &lt;rules&gt;
                &lt;rule name=&quot;LogFile&quot; patternSyntax=&quot;ECMAScript&quot; stopProcessing=&quot;true&quot;&gt;
                     &lt;match url=&quot;^[a-zA-Z0-9_\-]+\.js\.logs\/\d+\.txt$&quot;/&gt;
                &lt;/rule&gt;
                &lt;rule name=&quot;NodeInspector&quot; patternSyntax=&quot;ECMAScript&quot; stopProcessing=&quot;true&quot;&gt;
                    &lt;match url=&quot;^node-atlas.js\/debug[\/]?&quot; /&gt;
                &lt;/rule&gt;
                &lt;rule name=&quot;StaticContent&quot;&gt;
                     &lt;action type=&quot;Rewrite&quot; url=&quot;assets{REQUEST_URI}&quot;/&gt;
                &lt;/rule&gt;
                &lt;rule name=&quot;DynamicContent&quot;&gt;
                     &lt;conditions&gt;
                          &lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsFile&quot; negate=&quot;True&quot;/&gt;
                     &lt;/conditions&gt;
                     &lt;action type=&quot;Rewrite&quot; url=&quot;node-atlas.js&quot;/&gt;
                &lt;/rule&gt;
            &lt;/rules&gt;
        &lt;/rewrite&gt;
    &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><p>pour au final obtenir :</p><pre><code>site-hello-world/
— node_modules/
— languages/
—— default.json
— assets/
— templates/
—— index.htm
— node-atlas.js
— webconfig.json
— web.config
</code></pre><p>Il ne vous restera plus qu&#39;à cliquer sur « Browse <url-of-site> » dans votre panneau d&#39;action IIS8. Vous pouvez dès lors manager votre site (Démarrage / Arrêt / Recyclage de Pool) comme pour n&#39;importe quelle autre application IIS8.</url-of-site></p><h4 id="webconfig-exemple">webconfig exemple</h4><p>Un webconfig exemple pour une production :</p><pre><code class="lang-js">{
    &quot;urlPort&quot;: 80,
    &quot;httpPort&quot;: 7777,
    &quot;httpHostname&quot;: &quot;www.example.fr&quot;,
    &quot;routes&quot;: {
        ...
    }
}
</code></pre><h3 id="dans-un-environnement-unix-avec-forever">Dans un environnement Unix avec forever</h3><p>Il faut pour cela :</p><ol>
<li>Installer <a href="http://nodejs.org/download/">l’exécutable node.exe</a> capable d’exécuter du code JavaScript.</li>
<li>Installer <a href="https://github.com/nodejitsu/forever">le CLI tool forever</a> pour manager vos sites en continue (démarrage, arrêt, redémarrage, etc.).</li>
<li>Faire tourner en plus de vos sites un reverse-proxy pour que toutes vos applications tournent sur le port 80.</li>
</ol><h4 id="quelques-commandes-forever">Quelques commandes forever</h4><p>Pour manager un nouveau site en continue il faut utiliser la commande :</p><pre><code>\&gt; forever start &lt;/path/to/&gt;node-atlas/ --directory &lt;/path/to/your/website/directory/&gt;
</code></pre><p>Pour le stopper, il faut repérer son <strong>uid</strong> avec la commande <code>forever list</code></p><pre><code>\&gt; forever list
</code></pre><p>puis utiliser la commande :</p><pre><code>\&gt; forever stop &lt;uid&gt;
</code></pre><p>ou <code>&lt;uid&gt;</code> est l&#39;<strong>uid</strong> du site qui tourne.</p><h4 id="webconfig-exemple">webconfig exemple</h4><p>Un webconfig exemple pour une production :</p><pre><code class="lang-js">{
    &quot;urlPort&quot;: 80,
    &quot;httpPort&quot;: 7777,
    &quot;httpHostname&quot;: &quot;www.example.fr&quot;,
    &quot;routes&quot;: {
        ...
    }
}
</code></pre><p>Il vous faudra ensuite utiliser un reverse-proxy pour rendre votre site accessible sur le port 80.</p><h4 id="dans-un-environnement-unix-avec-nginx">Dans un environnement Unix avec Nginx</h4><p>Voici un exemple de configuration pour Nginx :</p><pre><code class="lang-javascript">## Server an.example.fr

upstream websocket {
    server Ip_backend:7777;
}

server {

    listen   80;
    server_name an.example.fr;

        keepalive_timeout    60;

    access_log on;

        access_log /var/log/nginx/access.log logstash;
    error_log /var/log/nginx/error-an.example.fr.log;

    location /socket.io/ {
            proxy_pass http://websocket;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection &quot;upgrade&quot;;
    }

    location / {
        proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $http_host;
            proxy_set_header X-NginX-Proxy true;

            proxy_pass http://websocket;
        proxy_read_timeout 300;
        proxy_connect_timeout 300;
        proxy_redirect off;

    }

    error_page 400 401 402 403 405 406 407 408 409 410 411 412 413 414 415 416 417 500 501 502 503 504 505 506 507 /error.html;

    location = /error.html {
            root /var/www/nginx-default;
    }
}
</code></pre><p><code>Ip_backend</code> doit être remplacé par l&#39;IP de votre sous-réseaux privé. Cela peut être <code>127.0.0.1</code> si la node tourne sur le même serveur que Nginx.</p><p><code>websocket</code> peut être remplacé par n&#39;importe quel mot, il faudra alors aussi modifier le <code>proxy_pass</code>. Il doit être unique à chaque node.</p><h3 id="proxy">Proxy</h3><h4 id="bouncy">Bouncy</h4><p>Bouncy est un exemple de reverse-proxy que vous pouvez utiliser pour faire tourner divers sites NodeAtlas (avec d&#39;autres types de site) ensemble sur le même port (le 80).</p><p>Vous pouvez par exemple :</p><ul>
<li>lancer 3 applications Node.js sur les ports 7777, 7778 et 7779 avec forever,</li>
<li>et en plus lancer un server apache sur le port 81</li>
</ul><p>et rendre tous vos sites accessibles derrière des noms de domaines sur le port 80 avec Bouncy par exemple.</p><p>Voici un exemple de configuration avec Bouncy :</p><p><strong>global-server.js</strong></p><pre><code class="lang-javascript">var bouncy = require(&#39;bouncy&#39;);

var server = bouncy(function (request, response, bounce) {
    if (request.headers.host === &#39;beep.example.com&#39;) {
        bounce(7777);
    }
    else if (request.headers.host === &#39;blup.example.com&#39;) {
        bounce(7776);
    }
    else if (request.headers.host === &#39;boop.example.com&#39;) {
        bounce(81);
    }
    else {
        response.statusCode = 404;
        response.end(&#39;no such host&#39;);
    }
});

server.listen(80);
</code></pre><p>que vous pouvez lancer avec :</p><pre><code>\&gt; forever start &lt;/path/to/&gt;global-server.js
</code></pre><p><a href="https://github.com/substack/bouncy">Plus d&#39;informations sur Bouncy</a></p>
				</div>
			</nav>
			<!-- Inclusion du fichiers minifié après génération. -->
			
			<script src="javascript/common.min.js"></script>

			<!-- Inclusion du fichiers standar pendant le développement. -->
			
		</div>
	</body>
</html>