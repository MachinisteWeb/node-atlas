<!DOCTYPE html><html lang="fr-fr"><head>
		<meta charset="utf-8">
		<title>NodeAtlas —Le Framework JavaScript Serveur Évolutif—</title>

		<base href="">

		<meta name="geo.placename" content="Annecy, Haute-Savoie, France">
		<meta name="description" content="Créez simplement des sites web évolutifs en Node.js.">

		<meta name="og:title" content="NodeAtlas —Le Framework JavaScript Serveur Évolutif—">
		<meta name="og:description" content="Créez simplement des sites web évolutifs en Node.js.">
		<meta name="og:url" content="https://node-atlas.js.org">
		<meta name="og:image" content="https://node-atlas.js.org/media/images/min/logo-big.png">
		<meta name="og:locale" content="fr-fr">
		<meta name="og:type" content="website">
		<meta name="og:updated_time" content="1553333059081">

		<meta name="robots" content="index, follow">

		<!--[if IE]><meta name="viewport" content="width=device-width, user-scalable=no" /><![endif]-->
		<!--[if !IE]><!--><meta name="viewport" content="initial-scale=1.0, user-scalable=no"><!--<![endif]-->

		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">

		<!-- Inclusion du fichiers minifié après génération. -->
		
		<link rel="stylesheet" href="stylesheets/common.min.css">

		<!-- Inclusion du fichiers standar pendant le développement. -->
		
	</head>
	<body data-content="content/" data-subpath="" style="background-image: url('media/images/min/main-background.jpg');">
		<div class="layout">
			<noscript class="no-js cmpt">
				<div class="no-js--inner">
					<p>Le JavaScript n'est pas activé.</p>
				</div>
			</noscript>
			<div class="background"></div>
			<div class="language cmpt">
				<div class="navigation--lang">
					<a href="/english/index.html" title="International Version"><span class="fa fa-globe"></span>  International Version</a>
				</div>
			</div>
			<header class="header cmpt">
				<div class="header--inner">
					<div class="header--information">
						<div class="header--information--github">
							<a class="header--information--donate" href="https://www.paypal.me/BrunoLesieur/5"><img src="https://img.shields.io/badge/don-%E2%9D%A4-ddddff.svg" alt="Faites un don" data-canonical-src="https://img.shields.io/badge/don-%E2%9D%A4-ddddff.svg"></a>
							<a class="header--information--follow github-button" href="https://github.com/Haeresis" data-count-href="/Haeresis/followers" data-count-api="/users/Haeresis#followers" data-count-aria-label="# followers on GitHub" aria-label="Suivre @Haeresis on GitHub">Suivre</a>
						</div>
						<div class="header--information--npm">
							<a class="header--information--package" href="https://www.npmjs.com/package/node-atlas"><img src="https://badge.fury.io/js/node-atlas.svg" alt="Package NPM" data-canonical-src="https://badge.fury.io/js/node-atlas.svg"></a>
							<a class="header--information--star github-button" href="https://github.com/NodeAtlas/node-atlas" data-icon="octicon-star" data-count-href="/NodeAtlas/node-atlas/stargazers" data-count-api="/repos/NodeAtlas/node-atlas#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star NodeAtlas/node-atlas on GitHub">Star</a>
						</div>
					</div>
					<div class="header--background"></div>
					<div class="header--title">
						<h1>
							<img class="header--title--node" src="media/images/min/ode.png" alt="Node">
							<img class="header--title--atlas" src="media/images/min/tlas.png" alt="Atlas">
							<img class="header--title--trans" src="media/images/min/transparent.png" alt="NodeAtlas">
						</h1>
					</div>
					<div class="header--abstract">
						<p>Le Framework JavaScript Serveur Évolutif</p>
					</div>
					<div class="header--main">
						<ul>
							<li>
								<div class="header--main--first">
									<h2><span>Mise en place</span> <strong>Simple</strong></h2>
									<p>Au point avec <strong>HTML &amp; CSS</strong> ?<br><strong>Débutant</strong> en JavaScript ?</p>
									<p class="small">Réalisez rapidement des sites vitrines multilingues sans effort avec l'utilisation de routes, vues ou variations.</p>
								</div>
							</li>
							<li>
								<div class="header--main--second">
									<h2><span>Site vivant et</span> <strong>Évolutif</strong></h2>
									<p><strong>Expert</strong> en JavaScript client ?<br>Prêt à embrasser <strong>Node.js</strong> ?</p>
									<p class="small">Améliorer progressivement votre base à mesure de vos besoins en utilisant des contrôleurs, modèles ou modules.</p>
								</div>
							</li>
							<li>
								<div class="header--main--third">
									<h2><span>Partie Cliente</span> <strong>Agnostique</strong></h2>
									<p>Déjà vos habitudes <strong>Front-end</strong> ?<br>Habitué(e) du <strong>Data Binding</strong> ?</p>
									<p class="small">Du léger Vanilla au simple jQuery en passant par Vue, Angular ou React : utiliser vos bibliothèques clientes favorites !</p>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</header>
<div class="popup cmpt">
	<aside class="popup--inner">
		<div class="popup--versus"><del class="close">Fermer</del><span class="fa fa-bolt" aria-hidden="true"></span><ins class="versus">Versus</ins></div>
		<div class="popup--nodeatlas"></div>
		<div class="popup--challenger"></div>
	</aside>
</div>
			<aside class="download cmpt">
				<div class="download--inner">
					<div class="download--install">
						<div class="download--cli is-active">
							<h2>Utilisation CLI</h2>
							<div class="download--cli--inner">
								<div class="download--cli--step1">
									<h3>Installer NodeAtlas</h3>
									<pre>$ npm install -g node-atlas</pre>
								</div>
								<div class="download--cli--step2">
									<h3>Créer un site test</h3>
									<pre>$ node-atlas --create</pre>
								</div>
								<div class="download--cli--step3">
									<h3>Lancer le site</h3>
									<pre>$ node-atlas --browse</pre>
								</div>
							</div>
						</div>
						<div class="download--api">
							<h2>Utilisation API</h2>
							<div class="download--api--inner">
								<div class="download--api--step1">
									<h3>Installer NodeAtlas</h3>
									<pre>$ npm install node-atlas</pre>
								</div>
								<div class="download--api--step2">
									<h3>Créer un script</h3>
									<pre><span>server.js</span>var NA = require("node-atlas"),
    website = NA();
website.init({
    "create": "hello-world"
}).created(function () {
    website.run({
        "browse": true
    });
}).start();</pre>
								</div>
								<div class="download--api--step3">
									<h3>Lancer le site</h3>
									<pre>$ node server.js</pre>
								</div>
							</div>
						</div>
					</div>
					<div class="download--clone">
						<div class="download--version">
							<h2>Télécharger</h2>
							<div class="download--version--inner">
								<div class="download--version--step1">
									<h3>v2.0.4</h3>
									<p class="download--clone--last"><a class="button" href="https://github.com/NodeAtlas/node-atlas/archive/master.zip" target="_blank">Dernière version</a></p>
									<p class="aside"><a href="https://github.com/NodeAtlas/node-atlas/releases">Anciennes versions</a></p>
								</div>
								<div class="download--version--step2">
									<h3>Cloner</h3>
									<p><input type="text" name="clone" data-instruction="Copier dans le presse-papier: Ctrl+C, Entrer" class="download--clone--text" value="https://github.com/NodeAtlas/node-atlas.git"><button><span class="fa fa-clipboard" aria-hidden="true"></span></button></p>
								</div>
							</div>
						</div>
					</div>
					<div class="download--battle">
						<div class="download--slide">
							<h2>Batailles Versus</h2>
							<div class="download--slide--inner">
								<div class="download--slide--step1">
									<img src="media/images/battles/node-atlas.png" alt="NodeAtlas API">
								</div>
								<div class="download--slide--step2">
									VS
								</div>
								<div class="download--slide--step3">
									<img src="media/images/battles/expressjs.png" alt="Concurrent">
								</div>
								<div class="download--slide--step4">
									<span class="fa fa-refresh" aria-hidden="true">
								</span></div>
							</div>
						</div>
					</div>
					<div class="download--info">
						<div class="download--tuto is-active">
							<h2>Tutoriaux</h2>
							<div class="download--tuto--inner">
								<div class="download--tuto--step1">
									<a href="avant-propos.html#avant-propos"><span>Découvrir</span> <i class="fa fa-book" aria-hidden="true"></i> le guide complet pas à pas</a>
								</div>
								<div class="download--tuto--step2">
									<span>ou</span>
								</div>
								<div class="download--tuto--step3">
									<div class="download--tuto--step3--first">
										<a href="https://blog.lesieur.name/des-sites-web-nodejs-pour-les-debutants-en-javascript-avec-nodeatlas/"><span>Créer</span> <i class="fa fa-html5" aria-hidden="true"></i> par ex. des sites web multilingues</a>
									</div>
									<div class="download--tuto--step3--second">
										<a href="https://blog.lesieur.name/creer-et-maintenir-des-maquettes-html-avec-node-atlas/"><span>Maintenir</span> <i class="fa fa-copy" aria-hidden="true"></i> par ex. des pages HTML sans serveur</a>
									</div>
									<div class="download--tuto--step3--third">
										<a href="https://github.com/NodeAtlas"><span>Développer</span> <i class="fa fa-database" aria-hidden="true"></i> par ex. des applications web réactives</a>
									</div>
								</div>
							</div>
						</div>
						<div class="download--about">
							<h2>À propos</h2>
							<div class="download--about--inner">
								<div class="download--about--step1">
									NodeAtlas est un Framework JavaScript MVC(2) côté serveur vous permettant de créer des sites évolutifs, SEO-compliant et W3C-compliant. C'est-à-dire qu'il permet de faire tourner des pages multilingues indexables ou de créer des maquettes HTML et passant la validation W3C uniquement avec des vues avec modifications à chaud mais également de créer de gros sites orientés composants et/ou orientés services en respectant les nouveaux standards !
								</div>
							</div>
						</div>
					</div>
				</div>
			</aside>
			<nav class="navigation cmpt">
				<div class="navigation--outer">
					<div class="navigation--start"><button class="button">Commencer</button></div>
					<div class="navigation--documentation"><button class="button">Documentation</button></div>
				</div>
				<div class="navigation--inner">
					<div class="navigation--lang">
						<a href="/english/index.html" title="International Version"><span class="fa fa-globe"></span>  International Version</a>
					</div>
					<div class="navigation--home">
						<img class="navigation--home--logo" src="media/images/logo.png" alt="Guide <span>NodeAtlas</span>" width="80px"> <a class="navigation--home--back" href="index.html" title="Guide <span>NodeAtlas</span>">Guide <span>NodeAtlas</span></a>
					</div>
					<div class="navigation--menu">
						<div class="navigation--menu--toggle">
							<span class="top"></span>
							<span class="middle"></span>
							<span class="bottom"></span>
						</div>
						<div class="navigation--menu--list">
							<div class="navigation--menu--list--inner">
								<h2>Menu</h2>
								<ul>
									
									<li>
										<a href="index.html" title="Guide">Guide</a>
										
										<i class="fa fa-chevron-down" aria-hidden="true"></i>
										<ul>
											
											<li>
												<a href="avant-propos.html" title="Avant-propos">Avant-propos</a>
											</li>
											
											<li>
												<a href="installation.html" title="Installation">Installation</a>
											</li>
											
											<li>
												<a href="introduction.html" title="Hello World !">Hello World !</a>
											</li>
											
											<li>
												<a href="partie-vue.html" title="Partie vue">Partie vue</a>
											</li>
											
											<li>
												<a href="partie-controleur.html" title="Partie contrôleur">Partie contrôleur</a>
											</li>
											
											<li>
												<a href="partie-outils.html" title="Partie outils">Partie outils</a>
											</li>
											
											<li>
												<a href="partie-avancee.html" title="Partie avancée">Partie avancée</a>
											</li>
											
										</ul>
										
									</li>
									
									<li>
										<a href="index.html" title="Documentation">Documentation</a>
										
										<i class="fa fa-chevron-down" aria-hidden="true"></i>
										<ul>
											
											<li>
												<a href="anatomie-du-webconfig.html" title="Webconfig">Webconfig</a>
											</li>
											
											<li>
												<a href="api-nodeatlas-comme-module-npm.html" title="API">API</a>
											</li>
											
											<li>
												<a href="cli-commandes-de-lancement.html" title="CLI">CLI</a>
											</li>
											
										</ul>
										
									</li>
									
									<li>
										<a href="index.html" title="Environnement">Environnement</a>
										
										<i class="fa fa-chevron-down" aria-hidden="true"></i>
										<ul>
											
											<li>
												<a href="nodeatlas-comme-simple-serveur-web.html" title="Simple Serveur">Simple Serveur</a>
											</li>
											
											<li>
												<a href="environnement-de-developpement.html" title="Développement">Développement</a>
											</li>
											
											<li>
												<a href="environnement-de-production.html" title="Production">Production</a>
											</li>
											
										</ul>
										
									</li>
									
									<li>
										<a href="https://gitter.im/NodeAtlas/Aide" title="Communauté">Communauté</a>
										
										<i class="fa fa-chevron-down" aria-hidden="true"></i>
										<ul>
											
											<li>
												<a href="https://gitter.im/NodeAtlas/Aide" title="Chat Gitter">Chat Gitter</a>
											</li>
											
											<li>
												<a href="https://github.com/NodeAtlas" title="Dépôt GitHub">Dépôt GitHub</a>
											</li>
											
											<li>
												<a href="plus-sur-nodeatlas.html" title="Alternatives">Alternatives</a>
											</li>
											
										</ul>
										
									</li>
									
								</ul>
							</div>
						</div>
					</div>
				</div>
			</nav>
			<div class="content cmpt">
				<div class="content--outer" data-name="Menu"></div>
				<div class="content--inner">
					<h2 id="partie-avancee">Partie avancée</h2><p>NodeAtlas offre également tout un système de fonctionnalités de développement et de packaging à travers son sytème de configuration. Voyons cela.</p><h3 id="page-404">Page 404</h3><h4 id="-couter-toutes-les-url-m-me-les-adresses-du-dossier-assetsrelativepath-">Écouter toutes les URL, même les adresses du dossier <code>assetsRelativePath</code></h4><p>Pour afficher une page personnalisée quand une ressource n'est pas trouvée il faut :</p><ol>
<li>Préparer une page 404.</li>
<li>Remplir le paramètre <code>pageNotFound</code> avec comme <code>value</code> la <code>key</code> de la page 404 préparée.</li>
</ol><p>Voyez l'exemple ci-dessous :</p><pre><code class="lang-json">{
   "pageNotFound": "/pages-inexistantes/",
   "routes": {
      "/liste-des-membres/": {
         "view": "members.htm"
      },
      "/": {
         "view": "index.htm"
      },
      "/pages-inexistantes/": {
         "view": "error.htm",
         "statusCode": 404
      }
   }
}
</code></pre><p>vous pourrez accéder à :</p><ul>
<li><em><a href="http://localhost/cette-page-n-existe-pas.html">http://localhost/cette-page-n-existe-pas.html</a></em></li>
<li><em><a href="http://localhost/elle/non/plus/">http://localhost/elle/non/plus/</a></em></li>
<li><em><a href="http://localhost/etc">http://localhost/etc</a></em></li>
</ul><h4 id="page-d-erreur-localis-e">Page d'erreur localisée</h4><p>Il vous suffit de créer une nouvelle route finissant par <code>*</code> dans la langue souhaitée.</p><p>Voyez l'exemple ci-dessous :</p><pre><code class="lang-json">{
   "pageNotFound": "/pages-inexistantes/",
   "languageCode": "fr-fr",
   "routes": {
      "/liste-des-membres/": {
         "view": "members.htm",
         "variation": "members.json"
      },
      "/": {
         "view": "index.htm",
         "variation": "index.json"
      },
      "/pages-inexistantes/": {
         "view": "error.htm",
         "variation": "error.json",
         "statusCode": 404
      },
      "/english/list-of-members/": {
         "view": "members.htm",
         "languageCode": "en-gb",
         "variation": "members.json"
      },
      "/english/": {
         "view": "index.htm",
         "languageCode": "en-gb",
         "variation": "index.json"
      },
      "/english/*": {
         "view": "error.htm",
         "languageCode": "en-gb",
         "variation": "error.json",
         "statusCode": 404
      }
   }
}
</code></pre><h3 id="routage-dynamique">Routage dynamique</h3><p>Bien que vous puissiez paramétrer des URL statiques, vous pouvez également paramétrer une écoute d'URL dynamiques !</p><h4 id="param-tres">Paramètres</h4><p>Il est possible de récupérer des paramètres de l'URL pour afficher un contenu différent en fonctions de ces paramètres.</p><p>Avec la configuration suivante :</p><pre><code class="lang-json">{
    "routes": {
        "/liste-des-membres/:member/:action/": {
            "view": "members.htm",
            "controller": "members.js"
        },
        "/liste-des-membres/:member/:action": {
            "view": "members.htm",
            "controller": "members.js"
        },
        "/liste-des-membres/:member/": {
            "view": "members.htm",
            "controller": "members.js"
        },
        "/liste-des-membres/:member": {
            "view": "members.htm",
            "controller": "members.js"
        },
        "/liste-des-membres/": {
            "view": "members.htm",
            "controller": "members.js"
        },
        "/liste-des-membres": {
            "view": "members.htm",
            "controller": "members.js"
        },
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>vous pourrez accéder à :</p><ul>
<li><em><a href="http://localhost/">http://localhost/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres">http://localhost/liste-des-membres</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/">http://localhost/liste-des-membres/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/">http://localhost/liste-des-membres/toto/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/bob-eponge99">http://localhost/liste-des-membres/bob-eponge99</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/node-atlas/show/">http://localhost/liste-des-membres/node-atlas/show/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/etc/lolol">http://localhost/liste-des-membres/etc/lolol</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/?example=test">http://localhost/liste-des-membres/?example=test</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/etc?example=test">http://localhost/liste-des-membres/etc?example=test</a></em> (en POST avec <code>test=This+is+a+test</code>)</li>
</ul><p>et récupérer les valeurs de <code>:member</code>, <code>:action</code>, <code>example</code> et <code>test</code> dans le <code>changeVariations</code> (commun et specifique).</p><pre><code class="lang-js">exports.changeVariations = function (next, locals, request, response) {

    console.log("param request:", request.params.member);
    // $ undefined, 'toto', 'bob-eponge99', 'node-atlas' or 'etc'.
    console.log("param locals:", locals.params.member);
    // $ undefined, 'toto', 'bob-eponge99', 'node-atlas' or 'etc'.

    console.log("param request", request.params.action);
    // $ undefined, 'show' or 'lolol'.
    console.log("param locals", locals.params.action);
    // $ undefined, 'show' or 'lolol'.

    console.log("query request", request.query.example);
    // $ undefined or 'test'
    console.log("query locals", locals.query.example);
    // $ undefined or 'test'

    console.log("body request", request.body.test);
    // $ undefined or 'This is a test'.
    console.log("body locals", locals.body.test);
    // $ undefined or 'This is a test'.

    next();
};
</code></pre><h4 id="param-tres-avanc-s">Paramètres avancés</h4><p>Nous voyons que nous utilisons une configuration identique pour trois routes dans l'exemple précédent. Vous pouvez également vous aider d'expressions régulières pour définir ce qui peut varier pour accéder à votre URL ou préciser quels sont les paramètres valides dans l'URL. Ce sytème est simplifié étant donné que beaucoup de caractères ne se trouvent pas dans l'URL. Il n'est donc pas nécéssaire par exemple d'échaper les <code>/</code> par exemple.</p><p>Avec la configuration suivante :</p><pre><code class="lang-json">{
    "routes": {
        "/liste-des-membres/?(:member([-a-zA-Z0-9]+)/?(:action(afficher|editer)/?)?)?": {
            "view": "members.htm"
        },
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>vous pourrez accéder à :</p><ul>
<li><em><a href="http://localhost/">http://localhost/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres">http://localhost/liste-des-membres</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/">http://localhost/liste-des-membres/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/">http://localhost/liste-des-membres/toto/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/bob-eponge99">http://localhost/liste-des-membres/bob-eponge99</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/node-atlas/show/">http://localhost/liste-des-membres/node-atlas/show/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/?example=test">http://localhost/liste-des-membres/?example=test</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/etc?example=test">http://localhost/liste-des-membres/etc?example=test</a></em> (en POST avec <code>test=This+is+a+test</code>)</li>
</ul><p>et récupérer les valeurs de <code>:member</code>, <code>:action</code>, <code>example</code> et <code>test</code> dans une vue.</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;URL Rewriting Test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    Member: &lt;strong&gt;&lt;?- params.member ?&gt;&lt;/strong&gt;&lt;br&gt;
    Action: &lt;strong&gt;&lt;?- params.action ?&gt;&lt;/strong&gt;&lt;br&gt;
    Example: &lt;strong&gt;&lt;?- query.example ?&gt;&lt;/strong&gt;&lt;br&gt;
    Test: &lt;strong&gt;&lt;?- body.test ?&gt;&lt;/strong&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>vous ne pourrez pas accéder à :</p><ul>
<li><em><a href="http://localhost/liste-des-membres/etc/lolol">http://localhost/liste-des-membres/etc/lolol</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/`toto_16`/afficher/">http://localhost/liste-des-membres/`toto_16`/afficher/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/`supprimer`/">http://localhost/liste-des-membres/toto/`supprimer`/</a></em></li>
</ul><h4 id="expressions-r-guli-res">Expressions régulières</h4><p>Vous pouvez également activer les expressions régulières pour un chemin précis avec <code>regExp</code>. Si celui-ci vaut <code>true</code>, le précédent mode ne fonctionne plus et vous passez en mode expression régulière. Si <code>regExp</code> est une chaine de caractères, celle-ci fait office de flag (g, i, m ou y).</p><p>Voyez la configuration suivante :</p><pre><code class="lang-js">{
    "routes": {
        "/liste-des-membres/([-a-z0-9]+)/?": {
            "view": "members.htm",
            "regExp": "i"
        },
        "/liste-des-membres/?": {
            "view": "members.htm",
            "regExp": true
        },
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>vous pourrez accéder à :</p><ul>
<li><em><a href="http://localhost/">http://localhost/</a></em></li>
<li><em><a href="http://localhost/liste-des-membres/">http://localhost/liste-des-membres/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres">https://localhost/liste-des-membres</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/toto/">http://localhost/liste-des-membres/toto/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/toto">https://localhost/liste-des-membres/toto</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/bob-eponge99/">http://localhost/liste-des-membres/bob-eponge99/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/bob-eponge99">https://localhost/liste-des-membres/bob-eponge99</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/node-atlas/">http://localhost/liste-des-membres/node-atlas/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/node-atlas">https://localhost/liste-des-membres/node-atlas</a></em>)</em></li>
<li><em><a href="http://localhost/liste-des-membres/etc/">http://localhost/liste-des-membres/etc/</a></em> <em>(ou <em><a href="https://localhost/liste-des-membres/etc">https://localhost/liste-des-membres/etc</a></em>)</em></li>
</ul><p>et récupérer les valeurs de <code>([-a-z0-9]+)</code> dans le <code>changeVariations</code> (commun et spécifique).</p><pre><code class="lang-js">exports.changeVariation = function (next, locals) {

    if (locals.params &amp;&amp; locals.params[0]) { locals.params.member = locals.params[0]; }
    // locals.params[1] pour le deuxième match, etc...

    console.log(locals.params.member);
    // $ 'toto', 'bob-eponge99', 'node-atlas' ou 'etc'.

    next();
}
</code></pre><p>Les règles de création d'URL dynamiques avec <code>regExp</code> sont celles des <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScripts/Reference/Global_Objects/RegExp">RegExp JavaScript</a>.</p><h3 id="routage-programmatique">Routage programmatique</h3><p>Nous avons pu voir qu'avec <code>setRoutes</code> il était possible d'injecter dynamiquement des routes. Cependant, l'injection de route ne se fait qu'à la fin car <code>NA.webconfig.routes</code> est un objet. Il n'y a donc pas de moyen d'ordonner les routes, ce qui est génant car les routes sont résolue dans l'ordre dans lesquels elles ont été injectées.</p><p>Nous allons résoudre ça en changeant la manière de créer les routes de <code>routes: { &lt;key&gt;: { ... } }</code> à <code>routes: [{ "key": &lt;key&gt;, ... }]</code>.</p><p>Voici l'ensemble de fichier suivant :</p><pre><code>├─ controllers/
│  └─ common.js
├─ views/
│  ├─ index.htm
│  ├─ content.htm
│  └─ error.htm
└─ webconfig.json
</code></pre><p>Avec le <code>webconfig.json</code> initialement comme ceci avec <code>routes: &lt;Object&gt;</code> :</p><pre><code class="lang-json">{
    "controller": "common.js",
    "routes": {
        "/doc/index.html": {
            "view": "index.htm"
        },
        "/doc/*": {
            "view": "error.htm",
            "statusCode": 404
        }
    }
}
</code></pre><p>se transformant en cela avec <code>routes: &lt;Array&gt;</code> :</p><pre><code class="lang-json">{
    "controller": "common.js",
    "routes": [{
        "url": "/doc/index.html",
        "view": "index.htm"
    }, {
        "url": "/doc/*",
        "view": "error.htm",
        "statusCode": 404
    }]
}
</code></pre><p>Avec le fichier <code>common.js</code> nous pouvons maintenant injecter les routes à des positions précises. Nous allons les ajouter au début.</p><pre><code class="lang-js">// On intervient au niveau des routes pendant qu'elles sont ajoutées.
// Ce code sera exécuté au lancement de NodeAtlas.
exports.setRoutes = function (next) {

    // On récupère l'instance de NodeAtlas en cours.
    var NA = this,

        // Et nous récupérons les routes en provenance du webconfig...
        route = NA.webconfig.routes;

    // ...pour ajouter la route `/content.html` au débuts de nos routes.
    route.unshift({
        "url": "/doc/content.html",
        "view": "content.htm"
    });

    // On redonne la main à NodeAtlas pour la suite.
    next();
};
</code></pre><p>De cette manière l'adresse <code>http://localhost/doc/content.html</code> renverra la vue <code>content.htm</code> et non la vue <code>error.htm</code> en 404.</p><h3 id="redirections">Redirections</h3><p>Pour aller à une autre adresse (redirection 301 ou 302) quand vous arrivez à une url il faut utiliser le paramètre <code>redirect</code>.</p><p><em>Note : si vous ne précisez pas un <code>statusCode</code>, la redirection ne se fera pas. Le <code>statusCode</code> est obligatoire.</em></p><h4 id="en-statique">En statique</h4><p>Voyez l'exemple ci-dessous :</p><pre><code class="lang-json">{
    "routes": {
        "/liste-des-membres/": {
            "view": "members.htm"
        },
        "/liste-des-membres": {
            "redirect": "/liste-des-membres/",
            "statusCode": 301
        },
        "/aller-sur-node-atlas/": {
            "redirect": "https://node-atlas.js.org/",
            "statusCode": 302
        },
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>Vous serez redirigé :</p><ul>
<li>sur <code>http://localhost/liste-des-membres/</code> quand vous accéderez à <code>http://localhost/liste-des-membres</code> avec une entête <em>redirection permanente</em>.</li>
<li>sur <code>https://node-atlas.js.org/</code> quand vous accéderez à <code>http://localhost/aller-sur-node-atlas/</code> avec une entête <em>redirection temporaire</em>.</li>
</ul><h4 id="en-dynamique">En dynamique</h4><p>Voyez l'exemple ci-dessous :</p><pre><code class="lang-json">{
    "routes": {
        "/liste-des-membres/:member/": {
            "view": "members.htm"
        },
        "/liste-des-membres/:member": {
            "redirect": "/liste-des-membres/:member/",
            "statusCode": 301
        },
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>Vous serez redirigé sur <code>http://localhost/liste-des-membres/haeresis/</code> quand vous accéderez à <code>http://localhost/liste-des-membres/haeresis</code> avec une entête <em>redirection permanente</em>.</p><h4 id="avec-expressions-r-guli-res">Avec expressions régulières</h4><p>Voyez l'exemple ci-dessous :</p><pre><code class="lang-js">{
    "routes": {
        "/membres/([-a-z0-9]+)/": {
            "view": "members.htm",
            "regExp": true
        },
        "/liste-des-membres/([-a-z0-9]+)/": {
            "redirect": "/membres/$0/",
            "statusCode": 301,
            "regExp": true
        },
        "/liste-des-membres/": {
            "view": "members.htm"
        },
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>Vous serez redirigé sur <code>http://localhost/membres/haeresis/</code> quand vous accéderez à <code>http://localhost/liste-des-membres/haeresis/</code> avec une entête <em>redirection permanente</em>.</p><p>Pour le second <em>match</em> utilisez $1, pour le troisième $2, etc.</p><h3 id="entetes-http">Entêtes HTTP</h3><p>Par défaut, les entêtes HTTP envoyées par NodeAtlas sont les suivantes : <code>Content-Type:text/html; charset=utf-8</code> avec un <code>statusCode</code> à 200.</p><p>Il est tout à fait possible de modifier ces valeurs pour une entrée de route (pour des APIs local au site).</p><pre><code class="lang-json">{
    "mimeType": "application/json",
    "charset": "utf-16",
    "routes": {
        "/": {
            "view": "index.htm",
            "mimeType": "text/html"
        },
        "/api/articles": {
            "view": "display-json.htm",
            "controller": "blog/list-of-articles.js",
            "charset": "utf-8",
            "statusCode": 203
        }
    }
}
</code></pre><p>Il est également possible de modifier complètement les entêtes, ce qui écrase toutes les autres valeurs de headers (à l'exception du <code>statusCode</code> donc). Mettre une valeur à <code>false</code> retire le Headers précédemment mis en place.</p><pre><code class="lang-json">{
    "headers": {
        "Content-Type": "application/json; charset=utf-8",
        "Access-Control-Allow-Origin": "*"
    },
    "routes": {
        "/api/articles": {
            "view": "display-json.htm",
            "controller": "blog/list-of-articles.js",
            "statusCode": 203,
            "headers": {
                "Access-Control-Allow-Origin": false
            }
        }
    }
}
</code></pre><h3 id="configuration-dynamique">Configuration dynamique</h3><p>Plutôt que d'utiliser plusieurs configurations statiques <code>.json</code>, il est tout a fait possible d'utiliser des configurations dynamiques <code>.js</code>. Dans ce cas, ce que votre fichier <code>.js</code> devra retourner avec <code>module.exports</code> sera un objet JSON valide.</p><p>Nous pouvons ainsi aisément remplacer les six fichiers suivants :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "languageCode": "fr-fr",
    "statics": "statics.fr-fr.json",
    "routes": {
        "/": "index.htm"
    }
}
</code></pre><p><em>webconfig.prod.json</em></p><pre><code class="lang-json">{
    "cache": true,
    "languageCode": "fr-fr",
    "statics": "statics.fr-fr.json",
    "routes": {
        "/": "index.htm"
    }
}
</code></pre><p><em>webconfig.en-us.json</em></p><pre><code class="lang-json">{
    "languageCode": "fr-fr",
    "statics": "statics.fr-fr.json",
    "routes": {
        "/": "index.htm"
    }
}
</code></pre><p><em>webconfig.en-us.prod.json</em></p><pre><code class="lang-json">{
    "cache": true,
    "languageCode": "en-us",
    "statics": "statics.en-us.json",
    "routes": {
        "/": "index.htm"
    }
}
</code></pre><p><em>statics.fr-fr.json</em></p><pre><code class="lang-json">{
    "/variations/": "variations/fr-fr/",
}
</code></pre><p><em>statics.en-us.json</em></p><pre><code class="lang-json">{
    "/variations/": "variations/en-us/",
}
</code></pre><p>par les deux fichiers suivants :</p><p><em>webconfig.js</em></p><pre><code class="lang-js">module.export = (function () {
    var webconfig = {
        "cache": false,
        "languageCode": "fr-fr",
        "statics": "statics.json"
        "routes": {
            "/": "index.htm"
        }
    };

    if (process.env.NODE_ENV === 'production') {
        webconfig["cache"] = true;
    }

    if (process.env.LANG) {
        webconfig["languageCode"] = process.env.LANG;
    }

    return webconfig;
}());
</code></pre><p><em>statics.js</em></p><pre><code class="lang-js">module.export = (function () {
    var NA = this.NA,
        languageCode = NA.webconfig.languageCode

    return {
        "/variations/": "variations/" + languageCode + "/",
    };
}());
</code></pre><p>en supposant les variables d'environnements suivantes pour les quatre environnements suivants :</p><p>Local FR</p><pre><code class="lang-bash">NODE_ENV=DEVELOPMENT
LANG=fr-fr
</code></pre><p>Local EN</p><pre><code class="lang-bash">NODE_ENV=DEVELOPMENT
LANG=en-us
</code></pre><p>Prod FR</p><pre><code class="lang-bash">NODE_ENV=PRODUCTION
LANG=fr-fr
</code></pre><p>Prod EN</p><pre><code class="lang-bash">NODE_ENV=PRODUCTION
LANG=en-us
</code></pre><h3 id="https">HTTPs</h3><p>Il est très simple de faire tourner une instance de NodeAtlas avec le protocol HTTPs. Pour cela il suffit de créer, par exemple un dossier <code>security</code> dans lequel vous allez placer vos fichiers <code>server.key</code> et <code>server.crt</code> afin d'alimenter le protocol.</p><p>Il ne vous reste plus qu'à utiliser la configuration suivante :</p><pre><code class="lang-json">{
    "httpSecure": true,
    "httpSecureKeyRelativePath": "security/server.key",
    "httpSecureCertificateRelativePath": "security/server.crt",
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>Vous pouvez également, si —comme c'est le cas ici— vos deux fichiers <code>.key</code> et <code>.crt</code> portent le même nom, utiliser cette configuration :</p><pre><code class="lang-json">{
    "httpSecure": "security/server",
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>Pour finir, il est également possible de seulement laisser la valeur de <code>httpSecure</code> à <code>true</code> pour obtenir un <code>https</code> dans vos chemins comme <code>urlBasePath</code> ou <code>urlBase</code>. Cependant le serveur ce lancera en HTTP, il vous faudra un proxy qui gère pour vous la lecture du certificat.</p><pre><code class="lang-json">{
    "httpSecure": true,
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p><em>Note : en production, si vous redirigez un proxy vers votre instance de NodeAtlas, n'oubliez pas qu'en HTTPs ce n'est pas <code>urlPort: 80</code> mais <code>urlPort: 443</code></em></p><h3 id="get-post">GET / POST</h3><p>Vous pouvez également manager la manière dont le serveur va répondre aux demandes GET/POST pour une page donnée. Par exemple, nous allons autoriser l'accès aux pages uniquement en GET pour tout le site et autoriser un POST pour une page seulement (et même lui interdire le GET).</p><pre><code class="lang-json">{
    "get": true,
    "post": false,
    "routes": {
        "/": {
            "view": "index.htm"
        },
        "/liste-des-membres/": {
            "view": "members.htm"
        },
        "/rediger-commentaire/": {
            "view": "write-com.htm"
        },
        "/commentaire-sauvegarde/": {
            "view": "save-com.htm",
            "get": false,
            "post": true
        }
    }
}
</code></pre><p><em>Note : si rien n'est précisé,</em> <code>get</code> <em>et</em> <code>post</code> <em>sont à</em> <code>true</code> <em>au niveau global et par page.</em></p><h3 id="put-delete">PUT / DELETE</h3><p>Fonctionnant exactement de la même manière que <code>get</code> et <code>post</code>, les deux actions HTTP PUT et DELETE qui part défaut ne sont pas activé peuvent être activé avec <code>put</code> et <code>delete</code>.</p><pre><code class="lang-json">{
    "get": false,
    "post": false,
    "put": true,
    "routes": {
        "/read-all-entry/": {
            "view": "display-json.htm",
            "variation": "all-entry.json",
            "get": true,
            "put": false
        },
        "/read-entry/:id/": {
            "view": "display-json.htm",
            "variation": "entry.json",
            "get": true,
            "put": false
        },
        "/create-entry/:id/": {
            "view": "display-json.htm",
            "variation": "entry.json",
            "post": true,
            "put": false
        },
        "/update-entry/:id/": {
            "view": "display-json.htm",
            "variation": "entry.json"
        },
        "/delete-entry/:id/": {
            "view": "display-json.htm",
            "variation": "entry.json",
            "delete": true,
            "put": false
        }
    }
}
</code></pre><p>Avec la configuration ci-dessus, seulement une action HTTP n'est possible par entrée, cela permet de faire des APIs REST facilement avec NodeAtlas.</p><h3 id="cors-et-options">CORS et OPTIONS</h3><p>Par défaut, les requêtes pré-vérifiées ("preflighted requests") ne sont pas activées. Vous allez en avoir besoin pour, par exemple, effectuer des requêtes Cross-Domain ou CORS. Les requêtes pré-vérifiées se font avec la méthode HTTP OPTIONS.</p><p>Pour activer OPTIONS sur une route, utilisez la propriété <code>options</code> sur une route dans le webconfig. Pour activer OPTIONS sur toutes les routes, utilisez alors la propriété options du webconfig sur la configuration global.</p><pre><code class="lang-json">{
    "options": true,
    "routes": {
        "/read-all-entry/": {
            "view": "display-json.htm",
            "variation": "all-entry.json",
            "options": false
        },
        "/create-entry/:id/": {
            "view": "display-json.htm",
            "variation": "entry.json",
            "post": true
        },
        "/delete-entry/:id/": {
            "view": "display-json.htm",
            "variation": "entry.json",
            "delete": true
        }
    }
}
</code></pre><h4 id="demande-cross-domain">Demande cross-domain</h4><p>Si vous souhaitez authoriser une ressource du serveur NodeAtlas au requête en provenance de <code>www.domain-a.com</code> pour une page précise, vous pouvez le faire ainsi :</p><pre><code class="lang-json">{
    "routes": {
        "/api/random-quote": {
            "controller": "get-quote.js",
            "headers": {
                "Access-Control-Allow-Origin": "http://www.domain-a.com"
            }
        }
    }
}
</code></pre><p>Ainsi vous pourrez par exemple accepter la requête suivante qui a pour <code>Origin</code>, <code>http://www.domain-a.com</code> qui est donc une valeur de <code>Access-Control-Allow-Origin</code> :</p><pre><code class="lang-bash">GET /api/random-quote HTTP/1.1
Host: www.domain-a.com
...
Origin: http://www.domain-a.com
...
</code></pre><p><strong>Demande cross-domain avec jeton</strong></p><p>Si vous souhaitez authoriser des ressources du serveur NodeAtlas aux requêtes en provenance de n'importe quel domaine externe pour la page <code>/api/random-quote</code> et une page qui attend un jeton d'authentification pour la page <code>/api/protected/random-quote</code>, vous pouvez le faire ainsi :</p><pre><code class="lang-json">{
    "mimeType": "application/json",
    "headers": {
        "Access-Control-Allow-Origin": "*",
        "Access-Control-Allow-Headers": "Authorization"
    },
    "routes": {
        "/api/random-quote": {
            "controller": "get-quote.js"
        },
        "/api/protected/random-quote": {
            "controller": "get-quote.js",
            "middlewares": "is-authenticated.js",
            "options": true
        }
    }
}
</code></pre><p>Faire lire un jeton à NodeAtlas depuis un domaine externe nécessite de lui passer l'en-tête HTML <code>Authorization</code>. Pour que celle-ci soit acceptée par NodeAtlas il faut le définir avec <code>Access-Control-Allow-Headers</code> acceptant <code>Authorization</code>. L'envoi d'un jeton nécessitant une requête pré-vérifiée, il faut également mettre <code>options</code> à <code>true</code> pour autoriser les requêtes HTTP avec la méthode OPTIONS.</p><p>Ainsi vous pourrez par exemple accepter la requête suivante qui passe un jeton d'authentification à notre serveur pour la ressource <code>/api/protected/random-quote</code> :</p><pre><code class="lang-bash">GET /api/protected/random-quote HTTP/1.1
Host: localhost:1337
...
Origin: http://localhost
Authorization: Bearer CODE_DU_JETON
...
</code></pre><p><strong>Autre demande cross-domain</strong></p><p>Toutes les entêtes prévues pour faire fonctionner CORS sont acceptées via le mécanisme d'ajout d'en-tête de NodeAtlas.</p><h3 id="parametres-de-sessions">Paramètres de sessions</h3><h4 id="cl-et-secret">Clé et secret</h4><p>NodeAtlas gère lui-même les sessions stockées sur le serveur avec comme paramètres initiaux :</p><ul>
<li>Key : <code>nodeatlas.sid</code></li>
<li>Secret : <code>1234567890bépo</code></li>
</ul><p>qui permettent à un client de rester connecté à travers les pages à un même ensemble de variables personnelles côtés serveur.</p><p>Il est possible de modifier ces paramètres par défaut (et même obligatoire pour des sites en productions) avec les paramètres de <code>webconfig.json</code> suivant :</p><pre><code class="lang-json">{
    "sessionKey": "clé personnelle",
    "sessionSecret": "secret personnel"
}
</code></pre><p>NodeAtlas utilise également un objet de stockage mémoire (MemoryStore) qui stocke les informations dans la RAM du serveur.</p><h4 id="autres-param-tres">Autres paramètres</h4><p>Il est possible de changer l'intégralité des paramètres des sessions (sauf le MemoryStore) en utilisant la configuration de <code>webconfig.json</code> suivante :</p><pre><code class="lang-json">{
    "session": {
        "key": "clé personnelle",
        "secret": "secret personnel",
        "cookie": {
            "path": "/",
            "httpOnly": true,
            "secure": false,
            "maxAge": null
        },
        ...,
        ...,
        ...
    }
}
</code></pre><p>L'intégralité de la configuration possible se trouve sur la documentation du module <a href="https://github.com/expressjs/session">express-session</a>.</p><h3 id="stockage-de-sessions">Stockage de sessions</h3><p>Par défaut, c'est NodeAtlas qui stocke les sessions serveurs dans la RAM du serveur par application. Cela ne permet pas de partager des sessions utilisateurs à travers plusieurs applications NodeAtlas (ou autre) et efface toutes les sessions en cours pour une application en cas de redémarrage de celle-ci.</p><p>Pour résoudre ce souci, il convient de prendre en charge l'enregistrement des sessions via une base No SQL tel que <code>Redis</code> ou <code>MongoBD</code>.</p><p>Pour cela il suffit d'utiliser la fonction <code>setSessions</code> dans le fichier de <code>controller</code> commun.</p><h4 id="session-g-r-es-avec-redis">Session gérées avec Redis</h4><p>Implémentez le code suivant dans le <code>controller</code> commun pour stocker vos sessions dans Redis en local.</p><pre><code>exports.setModules = function () {
    var NA = this;

    NA.modules.RedisStore = require("connect-redis");
};

exports.setSessions = function (njsext) {
    var NA = this,
        session = NA.modules.session,
        RedisStore = NA.modules.RedisStore(session);

    NA.sessionStore = new RedisStore();

    next();
};
</code></pre><p>Plus d'informations sur <a href="https://www.npmjs.org/package/connect-redis">connect-redis</a>.</p><h4 id="session-g-r-es-avec-mongodb">Session gérées avec MongoDB</h4><p>Implémentez le code suivant dans <code>controllers/common.js</code> pour stocker vos sessions dans la database <code>sessions</code> d'une MongoDB locale.</p><pre><code>exports.setModules = function () {
    var NA = this;

    NA.modules.MongoStore = require("connect-mongo");
};

exports.setSessions = function (next) {
    var NA = this,
        session = NA.modules.session,
        MongoStore = NA.modules.MongoStore(session);

    NA.sessionStore = new MongoStore({
        db: "sessions"
    });

    next();
};
</code></pre><p>Plus d'informations sur <a href="https://www.npmjs.org/package/connect-mongo">connect-mongo</a>.</p><h3 id="url-d-ecoute">URL d'écoute</h3><p>Il est possible de générer une URL de visite différente des paramètres d'écoutes demandés avec <code>urlHostname</code> et <code>urlPort</code>. Par exemple on écoute la boucle local sur le port 80 car un script fait du Reverse Proxy depuis le port 7777 sur le 80 avec le module « http-proxy » comme ci-dessous :</p><pre><code class="lang-json">{
    "httpPort": 7777,
    "httpHostname": "127.0.0.1",
    "urlPort": 80,
    "urlHostname": "localhost",
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><h3 id="url-dynamiques">URL dynamiques</h3><h4 id="les-chemins-relatifs-en-absolue">Les chemins relatifs en absolue</h4><p>Il est possible que les chemins créés à partir de votre URL soient interprétés comme des sous-dossiers qui n'ont en réalité aucunes existences réelles. Cela a pour conséquence de rendre l'adresse <code>media/images/example.jpg</code> initialement accessible depuis un template affiché à <strong><a href="http://localhost">http://localhost</a></strong> impossible à récupérer quand le template est affiché à <strong><a href="http://localhost/sub-directory/">http://localhost/sub-directory/</a></strong> (puisqu'il faudrait alors que notre chemin soit plutôt <code>../media/images/example.jpg</code>).</p><p>Pour ne plus avoir à se soucier de l'accès aux ressources, peu importe l'URL qui est demandée, il suffit de transformer toutes les URL relatives telles que :</p><pre><code>&lt;link rel="stylesheet" type="text/css" href="stylesheets/common.css" /&gt;
&lt;!-- ... --&gt;
&lt;img src="media/images/example.jpg" /&gt;
&lt;!-- ... --&gt;
&lt;script type="text/javascript" src="javascripts/common.js"&gt;&lt;/script&gt;
</code></pre><p>en URL absolues avec la variable <code>urlBasePath</code> comme ci-dessous :</p><pre><code>&lt;link rel="stylesheet" type="text/css" href="&lt;?= urlBasePath ?&gt;stylesheets/common.css" /&gt;
&lt;!-- ... --&gt;
&lt;img src="&lt;?= urlBasePath ?&gt;media/images/example.jpg" /&gt;
&lt;!-- ... --&gt;
&lt;script type="text/javascript" src="&lt;?= urlBasePath ?&gt;javascripts/common.js"&gt;&lt;/script&gt;
</code></pre><p>À noter que dans le cas de la configuration suivante :</p><pre><code class="lang-json">{
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p><code>urlBasePath</code> retourne <code>http://localhost/</code> alors que dans celle-ci :</p><pre><code class="lang-json">{
    "httpPort": 7777,
    "urlRelativeSubPath": "sub/folder",
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p><code>urlBasePath</code> retourne <code>http://localhost:7777/sub/folder/</code>.</p><h4 id="les-chemins-des-templates">Les chemins des templates</h4><p>En utilisant le webconfig suivant :</p><pre><code class="lang-json">{
    "routes": {
        "/index.html": {
            "view": "index.htm"
        },
        "/contact.html": {
            "view": "contact.htm"
        }
    }
}
</code></pre><p>ainsi que la view <code>index.htm</code> correspondante</p><pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href="http://localhost/index.html"&gt;Lien vers l'accueil&lt;/a&gt;
&lt;a href="http://localhost/contact.html"&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre><p>je serais obligé de changer mon lien dans le template si je change le port d'écoute ou si je change le chemin de l'URL. Le changement de configuration suivant :</p><pre><code class="lang-json">{
    "httpPort": 7777,
    "routes": {
        "/home.html": {
            "view": "index.htm"
        },
        "/contact-us.html": {
            "view": "contact.htm"
        }
    }
}
</code></pre><p>me contraindrait à modifier le template précédent comme suit :</p><pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href="http://localhost:7777/home.html"&gt;Lien vers l'accueil&lt;/a&gt;
&lt;a href="http://localhost:7777/contact-us.html"&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre><p>Il est possible de solutionner ce problème en donnant une clé à un chemin précis et en déportant son chemin dans la propriété <code>url</code>.</p><p>Avec le webconfig suivant :</p><pre><code class="lang-json">{
    "routes": {
        "index": {
            "url": "/index.html",
            "view": "index.htm"
        },
        "contact": {
            "url": "/contact.html",
            "view": "contact.htm"
        }
    }
}
</code></pre><p>je peux à présent écrire le lien dans le template de manière dynamique :</p><ol>
<li><p>comme suit</p>
<pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href="&lt;?= urlBasePath ?&gt;&lt;?= webconfig.routes.home.url.slice(1) ?&gt;"&gt;Lien vers l'accueil&lt;/a&gt;
&lt;a href="&lt;?= urlBasePath ?&gt;&lt;?= webconfig.routes.contact.url.slice(1) ?&gt;"&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre>
<p><em>Note : <code>.slice(1)</code> permet de supprimer facilement le double <code>/</code> pour une URL fonctionnelle.</em></p>
</li>
<li><p>ou comme suit</p>
<pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href="&lt;?= urlBasePath ?&gt;.&lt;?= webconfig.routes.home.url ?&gt;"&gt;Lien vers l'accueil&lt;/a&gt;
&lt;a href="&lt;?= urlBasePath ?&gt;.&lt;?= webconfig.routes.contact.url ?&gt;"&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre>
<p><em>Note : Cela donnerait par exemple <code>http://localhost/./home.html</code>, ce qui est une URL fonctionnelle.</em></p>
</li>
<li><p>ou comme suit</p>
<pre><code class="lang-html">&lt;!-- ... --&gt;
&lt;a href="&lt;?= urlBasePathSlice + webconfig.routes.home.url ?&gt;"&gt;Lien vers l'accueil&lt;/a&gt;
&lt;a href="&lt;?= urlBasePathSlice + webconfig.routes.contact.url ?&gt;"&gt;Lien pour nous contacter&lt;/a&gt;
&lt;!-- ... --&gt;
</code></pre>
<p><em>Note : <code>urlBasePathSlice</code> renvoyant <code>http://localhost</code> au lieu de <code>http://localhost/</code> ou encore <code>http://localhost:7777/sub/folder</code> au lieu de <code>http://localhost:7777/sub/folder/</code>.</em></p>
</li>
</ol><h4 id="utilisation-de-la-cl-pour-mapper-les-pages">Utilisation de la clé pour mapper les pages</h4><p>Il est parfois utile de connaître la clé utilisée pour la page courante afin de trouver une équivalence dans une autre langue par exemple.</p><p>Avec le webconfig suivant :</p><pre><code class="lang-json">{
    "languageCode": "fr-fr",
    "routes": {
        "index_fr-fr": {
            "url": "/",
            "view": "/index.htm"
        },
        "index_en-us": {
            "url": "/english/",
            "view": "index.htm",
            "languageCode": "en-us"
        },
        "cv_fr-fr": {
            "url": "/cv/",
            "view": "cv.htm"
        },
        "cv_en-us": {
            "url": "/english/resume/",
            "view": "index.htm",
            "languageCode": "en-us"
        }
    }
}
</code></pre><p>et les fichiers de variation commun suivant en fr :</p><pre><code class="lang-json">{
    "language": [{
        "name": "Anglais",
        "code": "en-us"
    }, {
        "name": "Français",
        "code": "fr-fr"
    }]
}
</code></pre><p>en <code>en</code> :</p><pre><code class="lang-json">{
    "language": [{
        "name": "English",
        "code": "en-us"
    }, {
        "name": "French",
        "code": "fr-fr"
    }]
}
</code></pre><p>on peut alors créer un lien entre chaque page multilingue comme ceci :</p><pre><code class="lang-html">&lt;ul&gt;
    &lt;? for (var i = 0; i &lt; common.language.length; i++) { ?&gt;
    &lt;li&gt;&lt;a href="&lt;?= urlBasePath + webconfig.routes[routeKey.split('_')[0] + '_' + common.language[i].code].url ?&gt;"&gt;&lt;?- common.language[i].name ?&gt;&lt;/a&gt;&lt;/li&gt;
    &lt;? } ?&gt;
&lt;/ul&gt;
</code></pre><h3 id="moteur-de-template-personnalise">Moteur de template personnalisé</h3><p>Il est possible de laisser l'implémentation de <a href="http://expressjs.com/fr/guide/using-template-engines.html">Express prendre la main sur le moteur de rendu des vues</a>. Pour cela il faut utiliser le paramètre <code>engine</code>. Un exemple en utilisant le moteur Handlebars :</p><p>Tout d'abord, ajouter le middleware Express Handlebars à vos modules :</p><pre><code>npm install express-handlebars
</code></pre><p>puis utiliser <code>engine</code> avec la valeur arbitraire <code>hbs</code></p><pre><code>{
    "engine": "hbs",
    "controller": "common.js",
    "variation": "common.json",
    "routes": {
        "/": {
            "view": "index.hbs",
            "variation": "index.json"
        }
    }
}
</code></pre><p>puis expliquer au moteur Express de NodeAtlas comment rendre les vues :</p><pre><code class="lang-js">exports.setModules = function () {
    var NA = this;

    NA.modules.exphbs = require("express-handlebars");
};

exports.setConfigurations = function (next) {
  var NA = this,
    exphbs = NA.modules.exphbs;

    NA.express.engine("hbs", exphbs());

    next();
};
</code></pre><p>enfin voyons rapidement ce que le fichier <code>index.hbs</code> pourrait contenir :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;title&gt;{{specific.titlePage}}&lt;/title&gt;
        &lt;link rel="stylesheet" href="stylesheets/{{common.classCssCommon}}.css" media="all"&gt;
        &lt;link rel="stylesheet" href="stylesheets/{{specific.classPage}}.css" media="all"&gt;
    &lt;/head&gt;
    &lt;body class="{{specific.classPage}}"&gt;
        &lt;div&gt;
            &lt;h1&gt;{{specific.titlePage}}&lt;/h1&gt;
            {{{specific.content}}}
        &lt;/div&gt;
        &lt;script async="true" type="text/javascript" src="javascripts/{{common.classJsCommon}}.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Ce que fait <code>engine</code>, c'est abandonner le système de NodeAtlas et passer par celui d'Express. Comme Express a besoin d'un objet <code>response</code> pour rendre une vue, il est impossible d'utiliser ce mécanisme via l'utilisation de la fonction <code>NA.view</code> de l'API NodeAtlas, celle-ci ne supportant que le moteur NodeAtlas, EJS et Pug.</p><h4 id="diff-rence-entre-engine-templateenginedelimiter-et-pug-">Différence entre <code>engine</code>, <code>templateEngineDelimiter</code> et <code>pug</code></h4><p>Il est tout a fait possible de passer par Express pour rendre EJS et Pug. Dans ce cas, puisque <code>node-atlas</code> embarque les modules <code>ejs</code> et <code>pug</code> en tant que dépendance, il n'est pas nécéssaire de passer par le <code>controller</code> commun et l'utilisation de <code>npm</code> pour les mettre en place. Il suffit juste d'utiliser <code>engine: "ejs"</code> ou <code>engine: "pug"</code>.</p><p>Cependant, faire cela retire les bénéfices apportés par NodeAtlas pour l'utilisation de ces deux moteurs comme par exemple le support des inclusions dynamiques pour Pug dans la <code>view</code> avec <code>#{routeParameters.view}</code>.</p><h3 id="pas-de-vue">Pas de vue</h3><p>Il est possible de ne pas utiliser de vue et de seulement faire appel au contrôleur. Dans ce cas le point d'ancrage <code>changeVariations</code> est inutile. Il va falloir alimenter vous même <code>locals.dom</code> dans le point d'ancrage <code>changeDom</code>.</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "routes": {
        "/(:member/)?": {
            "controller": "index.js",
            "mimeType": "application/json"
        }
    }
}
</code></pre><p><em>controllers/index.js</em></p><pre><code class="lang-js">exports.changeDom = function (next, locals) {
    locals.dom = `{
  "params": ${locals.params.member},
  "query": ${locals.query.member},
  "body": ${locals.body.member}
}`;

    next();
};
</code></pre><p>Ainsi à l'adresse <code>http://localhost/riri/?query=fifi</code> demandé en POST avec le body <code>member=loulou</code> vous obtiendrez la sortie :</p><pre><code class="lang-json">{
  "params": "riri",
  "query": "fifi",
  "body": "loulou"
}
</code></pre><h4 id="pas-de-routes">Pas de routes</h4><p>Pas un seul webconfig présenté dans la documentation ne se passe du paramètre <code>routes</code>. Pourtant il est facultatif au même titre que tous les autres. Aussi avec le webconfig suivant :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "controller": "common.js"
}
</code></pre><p>et le contrôleur suivant :</p><p><em>controllers/common.js</em></p><pre><code class="lang-js">exports.setRoutes = function (next) {
    var NA = this,
        route = NA.webconfig.routes = {};

    route["/"] = {
        "mimeType": "text/plain"
    };

    next();
};

exports.changeDom = function (next, locals) {

    locals.dom = "Hello World";

    next();
};
</code></pre><p>Il est tout à fait possible d'obtenir à l'adresse <code>http://localhost/</code> le simple message « Hello World ».</p><h3 id="cache">Cache</h3><p>C'est une bonne chose de ne pas reservir des fichiers qui n'ont pas bougé pour la production. Vous pouvez mettre à <code>true</code> la valeur du webconfig <code>cache</code> pour ça:</p><pre><code class="lang-json">{
    "cache": true,
    "route": {
        "/": "index.htm"
    }
}
</code></pre><p>Vous pouvez également lancer <code>node-atlas</code> avec l'option <code>--cache</code> :</p><blockquote>
<pre><code class="lang-bash">node-atlas --cache
</code></pre>
</blockquote><p>ou mettre votre variable d'environnement <code>NODE_ENV</code> à <code>production</code> :</p><blockquote>
<p>si vous êtes sous Unix / MacOS</p>
<pre><code class="lang-bash">export NODE_ENV=production
</code></pre>
<p>ou si vous êtes sur Windows</p>
<pre><code class="lang-bash">SET NODE_ENV=production
</code></pre>
<p>ou vous pouvez démarrer NodeAtlas comme suit</p>
<pre><code class="lang-bash">NODE_ENV=production node-atlas
</code></pre>
<p>ou vous pouvez la définir dans votre fichier JavaScript :</p>
<pre><code class="lang-js">process.env.NODE_ENV = "production";
</code></pre>
</blockquote><h3 id="base-de-donnees-sql">Base de données SQL</h3><p>Nous allons voir à présent comment utiliser des informations venant d'une base de données. Pour cela nous allons utiliser une base MySQL comme exemple. Le module npm <code>mysql</code> va donc nous être utile. Il va également nous falloir <a href="https://dev.mysql.com/downloads/installer/">installer un serveur MySQL</a>.</p><p>Donc, depuis le dossier du <code>webconfig.json</code>, utilisez :</p><pre><code class="lang-bash">npm install mysql
</code></pre><h4 id="base-de-donn-es-mysql">Base de données MySQL</h4><p>Tout d'abord, nous allons alimenter la base de données avec la base <code>demo</code> :</p><pre><code class="lang-sql">CREATE DATABASE demo;
</code></pre><p>et la sélectionner :</p><pre><code class="lang-sql">USE demo
</code></pre><p>puis créer la table <code>user</code> :</p><pre><code class="lang-sql">CREATE TABLE user
(
   id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
   lastname VARCHAR(100),
   firstname VARCHAR(100),
   email VARCHAR(255),
   birthdate DATE,
   gender TINYINT(1),
   country VARCHAR(255),
   town VARCHAR(255),
   zipcode VARCHAR(5),
   address VARCHAR(255)
);
</code></pre><p>et la remplir avec un jeu de données :</p><pre><code class="lang-sql">INSERT INTO user (
   lastname,
   firstname,
   email,
   birthdate,
   gender,
   country,
   town,
   zipcode,
   address
) VALUES (
   "Elric",
   "Edward",
   "edward.elric@fma.br",
   "2006/01/01",
   true,
   "Amestris",
   "Resembool",
   00000,
   "The Elric's house"
);
INSERT INTO user (
   lastname,
   firstname,
   email,
   birthdate,
   gender,
   country,
   town,
   zipcode,
   address
) VALUES (
   "Elric",
   "Alphonse",
   "alphonse.elric@fma.br",
   "2008/01/01",
   true,
   "Amestris",
   "Resembool",
   00000,
   "The Elric's house"
);
</code></pre><h4 id="fichiers-nodeatlas">Fichiers NodeAtlas</h4><p>Voyons à présent l'architecture de site que nous allons arbitrairement créer pour présenter notre exemple :</p><pre><code class="lang-txt">├─ controllers/
│  ├─ common.js
│  └─ index.js
├─ models/
│  ├─ objects/
│  │  └─ user.js
│  └─ connectors/
│     └─ user.js
├─ views/
│  └─ index.htm
├─ variations/
│  ├─ common.json
│  └─ index.json
└─ webconfig.json
</code></pre><p>Nous allons utiliser le <code>webconfig.json</code> suivant avec une variable custom <code>_mysqlConfig</code> qui contiendra toutes les informations pour se connecter à la base de données :</p><pre><code class="lang-json">{
   "controller": "common.js",
   "variation": "common.json",
   "statics": {
      "/models": "models/objects"
   },
   "routes": {
      "/": {
         "view": "index.htm",
         "variation": "index.json",
         "controller": "index.js"
      }
   },
   "_mysqlConfig": {
      "host": "localhost",
      "user": "root",
      "password": "root",
      "database": "demo"
   }
}
</code></pre><p>Nous allons ensuite nous connecter à la base de données avec le contrôleur globale <code>controllers/common.js</code> :</p><pre><code class="lang-js">exports.setModules = function () {
   var NA = this;

   // Import du module `mysql`.
   NA.modules.mysql = require('mysql');

   // Création de la collection de modèle...
   NA.models = {};
   // ...et récupération du modèle User avec accès à Mysql.
   NA.models.User = require('../models/connectors/user.js');
};

exports.setConfigurations = function (next) {
   var NA = this,
      path = NA.modules.path,
      mysql = NA.modules.mysql;

   // Créer un pool de connexion à MySQL.
   NA.mySql = mysql.createPool(NA.webconfig._mysqlConfig);

   next();
};
</code></pre><p>Et afficher les résultats via le contrôleur spécifique <code>controllers/index.js</code> :</p><pre><code class="lang-js">exports.changeVariations = function (next, locals) {
   var NA = this,
      user = new NA.models.User(),
      user2 = new NA.models.User(),
      user3 = new NA.models.User(),
      user4 = new NA.models.User();

   NA.mySql.getConnection(function(err, connection) {
      if (err) {
         throw err;
      }

      // Exemple de lecture.
      user
      .setConnection(connection)
      .lastname("Elric")
      .read(function (allUsers) {
         locals.user = user;
         locals.users = allUsers;

         // Exemple de création.
         user2
         .setConnection(connection)
         .firstname("Winry")
         .lastname("Rockbell")
         .email("winry.rockbell@fma.br")
         .gender(true)
         .create(function (infos) {
            locals.insertId = infos.insertId;
            locals.user2 = user2;

            // Exemple de modification.
            user3
            .gender(false)
            .birthdate("2008-01-01")
            .country("Amestris")
            .town("Resembool")
            .zipcode("99999")
            .address("The Rockbell's house");

            user2.update(user3, function (infos) {
               locals.affectedRows = infos.affectedRows;
               locals.user2 = user2;

               // Exemple de suppression.
               user4
               .setConnection(connection)
               .gender(false)
               .delete(function (infos) {
                  locals.deletedRows = infos.affectedRows;
                  next();
               });
            });
         });
      });
   });
};
</code></pre><p>en utilisant le modèle <code>user</code> via le fichier de connexion à la base de données <code>models/connectors/user.js</code> :</p><pre><code class="lang-js">var user = require('../objects/user.js');

function User(connection) {
   var privates = {},
      publics = this;

   user.call(publics);

   privates.connection = connection;

   publics.setConnection = function (connection) {
      privates.connection = connection;
      return publics;
   };

   publics.read = function (callback) {
      var select = `SELECT
               id,
               lastname,
               firstname,
               email,
               birthdate,
               gender,
               country,
               town,
               zipcode,
               address
            FROM user`,
         where = "";

      if (publics.id()) { where += ' &amp;&amp; `id` = ' + publics.id(); }
      if (publics.lastname()) { where += ' &amp;&amp; `lastname` = "' + publics.lastname() + '"'; }
      if (publics.firstname()) { where += ' &amp;&amp; `firstname` = "' + publics.firstname() + '"'; }
      if (publics.email()) { where += ' &amp;&amp; `email` = "' + publics.email() + '"'; }
      if (publics.birthdate()) { where += ' &amp;&amp; `birthdate` = "' + publics.birthdate() + '"'; }
      if (typeof publics.gender() === "boolean") { where += ' &amp;&amp; `gender` = ' + (publics.gender() ? 1 : 0); }
      if (publics.country()) { where += ' &amp;&amp; `country` = "' + publics.country() + '"'; }
      if (publics.town()) { where += ' &amp;&amp; `town` = "' + publics.town() + '"'; }
      if (publics.zipcode()) { where += ' &amp;&amp; `zipcode` = "' + publics.zipcode() + '"'; }
      if (publics.address()) { where += ' &amp;&amp; `address` = "' + publics.address() + '"'; }

      where = where.replace("&amp;&amp;", "WHERE");

      privates.connection.query(select + where, function (err, rows) {
         var users = [],
            user;

         if (err) {
            throw err;
         }

         if (rows[0]) {
            publics.id(rows[0].id);
            publics.lastname(rows[0].lastname);
            publics.firstname(rows[0].firstname);
            publics.email(rows[0].email);
            publics.birthdate(rows[0].birthdate);
            publics.gender((rows[0].gender) ? true : false);
            publics.country(rows[0].country);
            publics.town(rows[0].town);
            publics.zipcode(rows[0].zipcode);
            publics.address(rows[0].address);
         }

         for (var i = 0; i &lt; rows.length; i++) {
            user = new User();
            user.id(rows[i].id);
            user.lastname(rows[i].lastname);
            user.firstname(rows[i].firstname);
            user.email(rows[i].email);
            user.birthdate(rows[i].birthdate);
            user.gender((rows[i].gender) ? true : false);
            user.country(rows[i].country);
            user.town(rows[i].town);
            user.zipcode(rows[i].zipcode);
            user.address(rows[i].address);
            users.push(user);
         }

         if (callback) {
            callback(users);
         }
      });

      return publics;
   };

   publics.create = function (callback) {
      var insert = "INSERT INTO user (",
         values = ") VALUES (";

      if (publics.id()) {
         insert += "`id`, ";
         values += publics.id() + ', ';
      }
      if (publics.lastname()) {
         insert += "`lastname`, ";
         values += '"' + publics.lastname() + '", ';
      }
      if (publics.firstname()) {
         insert += "`firstname`, ";
         values += '"' + publics.firstname() + '", ';
      }
      if (publics.email()) {
         insert += "`email`, ";
         values += '"' + publics.email() + '", ';
      }
      if (publics.birthdate()) {
         insert += "`birthdate`, ";
         values += '"' + publics.birthdate() + '", ';
      }
      if (typeof publics.gender() === "boolean") {
         insert += "`gender`, ";
         values += (publics.gender() ? 1 : 0) + ', ';
      }
      if (publics.country()) {
         insert += "`country`, ";
         values += '"' + publics.country() + '", ';
      }
      if (publics.town()) {
         insert += "`town`, ";
         values += '"' + publics.town() + '", ';
      }
      if (publics.zipcode()) {
         insert += "`zipcode`, ";
         values += '"' + publics.zipcode() + '", ';
      }
      if (publics.address()) {
         insert += "`address`, ";
         values += '"' + publics.address() + '", ';
      }

      insert = insert.replace(/, $/g, "");
      values = values.replace(/, $/g, ")");

      privates.connection.query(insert + values, function (err, infos) {
         if (err) {
            throw err;
         }

         publics.id(infos.insertId);

         if (callback) {
            callback(infos);
         }
      });

      return publics;
   };

   publics.update = function (user, callback) {
      var update = "UPDATE user SET",
         where = "";

      if (user.id()) { update += '`id` = ' + user.id() + ', '; }
      if (user.lastname()) { update += '`lastname` = "' + user.lastname() + '", '; }
      if (user.firstname()) { update += '`firstname` = "' + user.firstname() + '", '; }
      if (user.email()) { update += '`email` = "' + user.email() + '", '; }
      if (user.birthdate()) { update += '`birthdate` = "' + user.birthdate() + '", '; }
      if (typeof user.gender() === "boolean") { update += '`gender` = ' + (user.gender() ? 1 : 0) + ', '; }
      if (user.country()) { update += '`country` = "' + user.country() + '", '; }
      if (user.town()) { update += '`town` = "' + user.town() + '", '; }
      if (user.zipcode()) { update += '`zipcode` = "' + user.zipcode() + '", '; }
      if (user.address()) { update += '`address` = "' + user.address() + '", '; }

      update = update.replace(/, $/g, "");

      if (publics.id()) { where += ' &amp;&amp; `id` = ' + publics.id(); }
      if (publics.lastname()) { where += ' &amp;&amp; `lastname` = "' + publics.lastname() + '"'; }
      if (publics.firstname()) { where += ' &amp;&amp; `firstname` = "' + publics.firstname() + '"'; }
      if (publics.email()) { where += ' &amp;&amp; `email` = "' + publics.email() + '"'; }
      if (publics.birthdate()) { where += ' &amp;&amp; `birthdate` = "' + publics.birthdate() + '"'; }
      if (typeof publics.gender() === "boolean") { where += ' &amp;&amp; `gender` = ' + (publics.gender() ? 1 : 0); }
      if (publics.country()) { where += ' &amp;&amp; `country` = "' + publics.country() + '"'; }
      if (publics.town()) { where += ' &amp;&amp; `town` = "' + publics.town() + '"'; }
      if (publics.zipcode()) { where += ' &amp;&amp; `zipcode` = "' + publics.zipcode() + '"'; }
      if (publics.address()) { where += ' &amp;&amp; `address` = "' + publics.address() + '"'; }

      where = where.replace("&amp;&amp;", "WHERE");

      privates.connection.query(update + where, function (err, infos) {
         if (err) {
            throw err;
         }

         if (user.id()) { publics.id(user.id()); }
         if (user.lastname()) { publics.lastname(user.lastname()); }
         if (user.firstname()) { publics.firstname(user.firstname()); }
         if (user.email()) { publics.email(user.email()); }
         if (user.birthdate()) { publics.birthdate(user.birthdate()); }
         if (typeof publics.gender() === "boolean") { publics.gender(user.gender()); }
         if (user.country()) { publics.country(user.country()); }
         if (user.town()) { publics.town(user.town()); }
         if (user.zipcode()) { publics.zipcode(user.zipcode()); }
         if (user.address()) { publics.address(user.address()); }

         if (callback) {
            callback(infos);
         }
      });

      return publics;
   };

   publics.delete = function (callback) {
      var del = "DELETE FROM user",
         where = "";

      if (publics.id()) { where += ' &amp;&amp; `id` = ' + publics.id(); }
      if (publics.lastname()) { where += ' &amp;&amp; `lastname` = "' + publics.lastname() + '"'; }
      if (publics.firstname()) { where += ' &amp;&amp; `firstname` = "' + publics.firstname() + '"'; }
      if (publics.email()) { where += ' &amp;&amp; `email` = "' + publics.email() + '"'; }
      if (publics.birthdate()) { where += ' &amp;&amp; `birthdate` = "' + publics.birthdate() + '"'; }
      if (typeof publics.gender() === "boolean") { where += ' &amp;&amp; `gender` = ' + (publics.gender() ? 1 : 0); }
      if (publics.country()) { where += ' &amp;&amp; `country` = "' + publics.country() + '"'; }
      if (publics.town()) { where += ' &amp;&amp; `town` = "' + publics.town() + '"'; }
      if (publics.zipcode()) { where += ' &amp;&amp; `zipcode` = "' + publics.zipcode() + '"'; }
      if (publics.address()) { where += ' &amp;&amp; `address` = "' + publics.address() + '"'; }

      where = where.replace("&amp;&amp;", "WHERE");

      privates.connection.query(del + where, function (err, infos) {
         if (err) {
            throw err;
         }

         if (publics.id()) { publics.id(undefined); }
         if (publics.lastname()) { publics.lastname(undefined); }
         if (publics.firstname()) { publics.firstname(undefined); }
         if (publics.email()) { publics.email(undefined); }
         if (publics.birthdate()) { publics.birthdate(undefined); }
         if (typeof publics.gender() === "boolean") { publics.gender(undefined); }
         if (publics.country()) { publics.country(undefined); }
         if (publics.town()) { publics.town(undefined); }
         if (publics.zipcode()) { publics.zipcode(undefined); }
         if (publics.address()) { publics.address(undefined); }

         if (callback) {
            callback(infos);
         }
      });

      return publics;
   };
}

User.prototype = Object.create(user.prototype);
User.prototype.constructor = User;

module.exports = User;
</code></pre><p>basé sur une classe <code>user</code> partagée entre la partie cliente et serveur <code>models/objects/user.js</code> :</p><pre><code class="lang-js">(function (expose, factory) {
   if (typeof module !== 'undefined' &amp;&amp; module.exports) {
      module.exports = factory;
   } else {
      expose.User = factory;
   }
}(this, function User() {
   var privates = {},
      publics = this;

   publics.id = function (id) {
      if (typeof id === 'undefined') {
         return privates.id;
      } else {
         privates.id = id;
         return publics;
      }
   };

   publics.lastname = function (lastname) {
      if (typeof lastname === 'undefined') {
         return privates.lastname;
      } else {
         privates.lastname = lastname;
         return publics;
      }
   };

   publics.firstname = function (firstname) {
      if (typeof firstname === 'undefined') {
         return privates.firstname;
      } else {
         privates.firstname = firstname;
         return publics;
      }
   };

   publics.email = function (email) {
      if (typeof email === 'undefined') {
         return privates.email;
      } else {
         privates.email = email;
         return publics;
      }
   };

   publics.birthdate = function (birthdate) {
      if (typeof birthdate === 'undefined') {
         return privates.birthdate;
      } else {
         privates.birthdate = birthdate;
         return publics;
      }
   };

   publics.gender = function (gender) {
      if (typeof gender === 'undefined') {
         return privates.gender;
      } else {
         privates.gender = gender;
         return publics;
      }
   };

   publics.country = function (country) {
      if (typeof country === 'undefined') {
         return privates.country;
      } else {
         privates.country = country;
         return publics;
      }
   };

   publics.town = function (town) {
      if (typeof town === 'undefined') {
         return privates.town;
      } else {
         privates.town = town;
         return publics;
      }
   };

   publics.zipcode = function (zipcode) {
      if (typeof zipcode === 'undefined') {
         return privates.zipcode;
      } else {
         privates.zipcode = zipcode;
         return publics;
      }
   };

   publics.address = function (address) {
      if (typeof address === 'undefined') {
         return privates.address;
      } else {
         privates.address = address;
         return publics;
      }
   };
}));
</code></pre><p>Avec les fichiers suivant pour afficher la page :</p><p><em>views/index.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
   &lt;head&gt;
      &lt;meta charset="utf-8" /&gt;
      &lt;title&gt;&lt;?- common.titleWebsite ?&gt;&lt;/title&gt;
   &lt;/head&gt;
   &lt;body&gt;
      &lt;div class="title"&gt;&lt;?- common.titleWebsite ?&gt;&lt;/div&gt;
      &lt;div&gt;
         &lt;h1&gt;&lt;?- specific.titlePage ?&gt;&lt;/h1&gt;
         &lt;div class="first"&gt;
            &lt;?- specific.content ?&gt;
            &lt;ul&gt;
               &lt;li&gt;Id: &lt;strong&gt;&lt;?- user.id() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Lastname: &lt;strong&gt;&lt;?- user.lastname() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Firstname: &lt;strong&gt;&lt;?- user.firstname() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Email: &lt;strong&gt;&lt;?- user.email() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Birthdate: &lt;strong&gt;&lt;?- user.birthdate() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Gender: &lt;strong&gt;&lt;?- user.gender() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Country: &lt;strong&gt;&lt;?- user.country() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Town: &lt;strong&gt;&lt;?- user.town() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Zipcode: &lt;strong&gt;&lt;?- user.zipcode() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Address: &lt;strong&gt;&lt;?- user.address() ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
         &lt;/div&gt;
         &lt;div class="all"&gt;
            &lt;?- specific.contents ?&gt;
            &lt;? for (var i = 0; i &lt; users.length; i++) { ?&gt;
            &lt;ul&gt;
               &lt;li&gt;Id: &lt;strong&gt;&lt;?- users[i].id() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Lastname: &lt;strong&gt;&lt;?- users[i].lastname() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Firstname: &lt;strong&gt;&lt;?- users[i].firstname() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Email: &lt;strong&gt;&lt;?- users[i].email() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Birthdate: &lt;strong&gt;&lt;?- users[i].birthdate() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Gender: &lt;strong&gt;&lt;?- users[i].gender() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Country: &lt;strong&gt;&lt;?- users[i].country() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Town: &lt;strong&gt;&lt;?- users[i].town() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Zipcode: &lt;strong&gt;&lt;?- users[i].zipcode() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Address: &lt;strong&gt;&lt;?- users[i].address() ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
            &lt;? } ?&gt;
         &lt;/div&gt;
         &lt;div class="last"&gt;
            &lt;?- specific.contentInsert ?&gt;
            &lt;p&gt;insertId: &lt;?- insertId ?&gt;&lt;/p&gt;
            &lt;p&gt;numberUpdate: &lt;?- affectedRows ?&gt;&lt;/p&gt;
            &lt;ul&gt;
               &lt;li&gt;Id: &lt;strong&gt;&lt;?- user2.id() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Lastname: &lt;strong&gt;&lt;?- user2.lastname() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Firstname: &lt;strong&gt;&lt;?- user2.firstname() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Email: &lt;strong&gt;&lt;?- user2.email() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Birthdate: &lt;strong&gt;&lt;?- user2.birthdate() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Gender: &lt;strong&gt;&lt;?- user2.gender() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Country: &lt;strong&gt;&lt;?- user2.country() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Town: &lt;strong&gt;&lt;?- user2.town() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Zipcode: &lt;strong&gt;&lt;?- user2.zipcode() ?&gt;&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Address: &lt;strong&gt;&lt;?- user2.address() ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
            &lt;p&gt;numberDelete: &lt;?- deletedRows ?&gt;&lt;/p&gt;
         &lt;/div&gt;
      &lt;/div&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>variations/common.json</em></p><pre><code class="lang-json">{
   "titleWebsite": "Exemple MySql",
   "male": "Homme",
   "female": "Femme"
}
</code></pre><p><em>variations/index.json</em></p><pre><code class="lang-json">{
   "titlePage": "Table User",
   "content": "&lt;p&gt;Détail de la première entrée.&lt;/p&gt;",
   "contents": "&lt;p&gt;Détail de toutes les entrées.&lt;/p&gt;",
   "contentInsert": "&lt;p&gt;Détail de l'utilisateur ajouté puis modifié.&lt;/p&gt;"
}
</code></pre><p>Vous obtiendrez la sortie suivante :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
   &lt;head&gt;
      &lt;meta charset="utf-8" /&gt;
      &lt;title&gt;MySql Exemple&lt;/title&gt;
   &lt;/head&gt;
   &lt;body&gt;
      &lt;div class="title"&gt;MySql Exemple&lt;/div&gt;
      &lt;div&gt;
         &lt;h1&gt;Table User&lt;/h1&gt;
         &lt;div class="first"&gt;
            &lt;p&gt;Détail de la première entrée.&lt;/p&gt;
            &lt;ul&gt;
               &lt;li&gt;Id: &lt;strong&gt;1&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Lastname: &lt;strong&gt;Elric&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Firstname: &lt;strong&gt;Edward&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Email: &lt;strong&gt;edward.elric@fma.br&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Birthdate: &lt;strong&gt;Sun Jan 01 2006 00:00:00 GMT+0100 (Paris, Madrid)&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Gender: &lt;strong&gt;true&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Country: &lt;strong&gt;Amestris&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Town: &lt;strong&gt;Resembool&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Zipcode: &lt;strong&gt;0&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Address: &lt;strong&gt;The Elric's house&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
         &lt;/div&gt;
         &lt;div class="all"&gt;
            &lt;p&gt;Détail de toutes les entrées.&lt;/p&gt;
            &lt;ul&gt;
               &lt;li&gt;Id: &lt;strong&gt;1&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Lastname: &lt;strong&gt;Elric&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Firstname: &lt;strong&gt;Edward&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Email: &lt;strong&gt;edward.elric@fma.br&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Birthdate: &lt;strong&gt;Sun Jan 01 2006 00:00:00 GMT+0100 (Paris, Madrid)&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Gender: &lt;strong&gt;true&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Country: &lt;strong&gt;Amestris&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Town: &lt;strong&gt;Resembool&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Zipcode: &lt;strong&gt;0&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Address: &lt;strong&gt;The Elric's house&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
            &lt;ul&gt;
               &lt;li&gt;Id: &lt;strong&gt;2&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Lastname: &lt;strong&gt;Elric&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Firstname: &lt;strong&gt;Alphonse&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Email: &lt;strong&gt;alphonse.elric@fma.br&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Birthdate: &lt;strong&gt;Tue Jan 01 2008 00:00:00 GMT+0100 (Paris, Madrid)&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Gender: &lt;strong&gt;true&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Country: &lt;strong&gt;Amestris&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Town: &lt;strong&gt;Resembool&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Zipcode: &lt;strong&gt;0&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Address: &lt;strong&gt;The Elric's house&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
         &lt;/div&gt;
         &lt;div class="last"&gt;
            &lt;p&gt;Détail de l'utilisateur ajouté puis modifié.&lt;/p&gt;
            &lt;p&gt;insertId: 3&lt;/p&gt;
            &lt;p&gt;numberUpdate: 1&lt;/p&gt;
            &lt;ul&gt;
               &lt;li&gt;Id: &lt;strong&gt;3&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Lastname: &lt;strong&gt;Rockbell&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Firstname: &lt;strong&gt;Winry&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Email: &lt;strong&gt;winry.rockbell@fma.br&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Birthdate: &lt;strong&gt;2008-01-01&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Gender: &lt;strong&gt;false&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Country: &lt;strong&gt;Amestris&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Town: &lt;strong&gt;Resembool&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Zipcode: &lt;strong&gt;99999&lt;/strong&gt;&lt;/li&gt;
               &lt;li&gt;Address: &lt;strong&gt;The Rockbell's house&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
            &lt;p&gt;numberDelete: 1&lt;/p&gt;
         &lt;/div&gt;
      &lt;/div&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="base-de-donnees-nosql">Base de données NoSQL</h3><p>Nous allons voir à présent comment utiliser des informations venant d'une base de données non sql. Pour cela nous allons utiliser le module npm <code>mongoose</code>. Il va également nous falloir <a href="https://www.mongodb.com/">installer un serveur MongoDB</a>.</p><p>Donc, depuis le dossier du <code>webconfig.json</code>, utilisez :</p><pre><code class="lang-bash">npm install mongoose
</code></pre><h4 id="base-de-donn-es-mongodb">Base de données MongoDB</h4><p>Tout d'abord, nous allons alimenter la base de données avec la base <code>demo</code> et la sélectionner :</p><pre><code class="lang-bash">use demo
</code></pre><p>puis créer la collection <code>user</code> :</p><pre><code class="lang-js">db.createCollection("user")
</code></pre><p>et la remplir avec un document :</p><pre><code class="lang-js">db.user.insert({
   email: "john.doe@unknown.com",
   identity: {
      lastname: "Doe",
      firstname: "John",
      gender: true,
      birthdate : new Date("1970/01/01")
   },
   location: {
      country: "Unknown",
      town: "Unknown",
      zipcode: "00000",
      address: "42 unknown"
   }
})
</code></pre><h4 id="fichiers-nodeatlas">Fichiers NodeAtlas</h4><p>Avec le jeu de fichier suivant :</p><pre><code class="lang-txt">├─ controllers/
│  ├─ common.js
│  └─ index.js
├─ models/
│  └─ user.js
├─ views/
│  └─ index.htm
├─ variations/
│  ├─ common.json
│  └─ index.json
└─ webconfig.json
</code></pre><p>Nous allons utiliser le <code>webconfig.json</code> suivant avec une variable custom <code>_mongodbConfig</code> qui contiendra toutes les informations pour se connecter à la base de données :</p><pre><code class="lang-json">{
   "controller": "common.js",
   "variation": "common.json",
   "statics": {
      "/models": "models"
   },
   "routes": {
      "/": {
         "view": "index.htm",
         "variation": "index.json",
         "controller": "index.js"
      }
   },
   "_mongodbConfig": {
      "host": "localhost",
      "port": "27017",
      "database": "demo"
   }
}
</code></pre><p>Avec les fichiers suivant pour afficher la page :</p><p><em>views/index.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="&lt;?- languageCode ?&gt;"&gt;
   &lt;head&gt;
      &lt;meta charset="utf-8" /&gt;
      &lt;title&gt;&lt;?- common.titleWebsite ?&gt;&lt;/title&gt;
   &lt;/head&gt;
   &lt;body&gt;
      &lt;div class="title"&gt;&lt;?- common.titleWebsite ?&gt;&lt;/div&gt;
      &lt;div&gt;
         &lt;h1&gt;&lt;?- specific.titlePage ?&gt;&lt;/h1&gt;
         &lt;?- specific.content ?&gt;
         &lt;ul&gt;
            &lt;li&gt;Id: &lt;strong&gt;&lt;?- id ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Lastname: &lt;strong&gt;&lt;?- lastname ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Firstname: &lt;strong&gt;&lt;?- firstname ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Email: &lt;strong&gt;&lt;?- email ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Birthdate: &lt;strong&gt;&lt;?- birthdate ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Gender: &lt;strong&gt;&lt;?- gender ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Country: &lt;strong&gt;&lt;?- country ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Town: &lt;strong&gt;&lt;?- town ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Zipcode: &lt;strong&gt;&lt;?- zipcode ?&gt;&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Address: &lt;strong&gt;&lt;?- address ?&gt;&lt;/strong&gt;&lt;/li&gt;
         &lt;/ul&gt;
      &lt;/div&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>variations/common.json</em></p><pre><code class="lang-json">{
   "titleWebsite": "MongoDB Exemple",
   "male": "Homme",
   "female": "Femme"
}
</code></pre><p><em>variations/index.json</em></p><pre><code class="lang-json">{
   "titlePage": "Collection User",
   "content": "&lt;p&gt;Détail du document `{ \"identity.firstname\": \"John\" }`.&lt;/p&gt;"
}
</code></pre><p>Enfin nous allons nous connecter à la base de données avec le contrôleur globale <code>controllers/common.js</code> :</p><pre><code class="lang-js">exports.setModules = function () {
   var NA = this,
      path = NA.modules.path;

   NA.modules.mongoose = require('mongoose');
   NA.models = {};
   NA.models.User = require('../models/user.js');
};

exports.setConfigurations = function (next) {
   var NA = this,
      mongoose = NA.modules.mongoose,
      config = NA.webconfig._mongodbConfig;

   mongoose.Promise = global.Promise;
   mongoose.model("user", NA.models.User, "user");
   mongoose.connect("mongodb://" + config.host + ":" + config.port + "/" + config.database, function (error) {
      next();
   });
};
</code></pre><p>Et afficher les résultats via le contrôleur spécifique <code>controllers/index.js</code> :</p><pre><code class="lang-js">exports.changeVariations = function (next, locals) {
   var NA = this,
      mongoose = NA.modules.mongoose,
      User = mongoose.model('user');

   User
   .findOne({ "identity.firstname": "John" })
   .exec(function (err, user) {

      locals.id = user._id;
      locals.lastname = user.identity.lastname;
      locals.firstname = user.identity.firstname;
      locals.birthdate = user.identity.birthdate;
      locals.email = user.email;
      locals.gender = (user.identity.gender) ? locals.common.male : locals.common.female;
      locals.country = user.location.country;
      locals.town = user.location.town;
      locals.zipcode = user.location.zipcode;
      locals.address = user.location.address;

      next();
   });
};
</code></pre><p>en utilisant sur une classe <code>user</code> partagée entre la partie cliente et la partie serveur <code>models/user.js</code> :</p><pre><code class="lang-js">var mongoose;
if (typeof module !== 'undefined' &amp;&amp; module.exports) {
    mongoose = require('mongoose');
}

(function (expose, factory) {
   if (mongoose) {
      module.exports = factory;
   } else {
      expose.User = factory;
   }
}(this, new mongoose.Schema({
   _id: mongoose.Schema.Types.ObjectId,
   email: { type : String, match: /^\S+@\S+$/ },
   identity: {
      lastname: String,
      firstname: String,
      gender: Boolean,
      birthdate : { type : Date, default : Date.now }
   },
   location: {
      country: String,
      town: String,
      zipcode: String,
      address: String
   }
})));
</code></pre><p>Vous obtiendrez la sortie suivante :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
   &lt;head&gt;
      &lt;meta charset="utf-8" /&gt;
      &lt;title&gt;Exemple MongoDB&lt;/title&gt;
   &lt;/head&gt;
   &lt;body&gt;
      &lt;div class="title"&gt;Exemple MongoDB&lt;/div&gt;
      &lt;div&gt;
         &lt;h1&gt;Collection User&lt;/h1&gt;
         &lt;p&gt;Détail de l'entrée `{ "identity.firstname": "John" }`.&lt;/p&gt;
         &lt;ul&gt;
            &lt;li&gt;Id: &lt;strong&gt;5804d4d530788ee2e52ea1c7&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Lastname: &lt;strong&gt;Doe&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Firstname: &lt;strong&gt;John&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Email: &lt;strong&gt;john.doe@unknown.com&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Birthdate: &lt;strong&gt;Mon Jan 01 1970 00:00:00 GMT+0200 (Paris, Madrid (heure d’été))&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Gender: &lt;strong&gt;Homme&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Country: &lt;strong&gt;Unknown&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Town: &lt;strong&gt;Unknown&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Zipcode: &lt;strong&gt;00000&lt;/strong&gt;&lt;/li&gt;
            &lt;li&gt;Address: &lt;strong&gt;42 unknown&lt;/strong&gt;&lt;/li&gt;
         &lt;/ul&gt;
      &lt;/div&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="application-isomorphique">Application isomorphique</h3><p>Une application isomorphique est une application dont le code JavaScript est en grande partie le même qu'il soit exécuté côté client ou exécuté côté serveur. NodeAtlas propose un exemple d'application isomorphique dans son template dédié à <a href="https://fr.vuejs.org/">Vue.js</a>.</p><p>Pour tester cela il vous suffit :</p><p>de créer un dossier de test</p><pre><code class="lang-bash">mkdir hello-vue
cd hello-vue
</code></pre><p>d'y placer les fichier de <code>hello-vue</code></p><pre><code class="lang-bash">node-atlas --create hello-vue
</code></pre><p>d'installer les dépendances</p><pre><code class="lang-bash">npm install
</code></pre><p>et de lancer le site en français</p><pre><code class="lang-bash">node-atlas --browse
</code></pre><p>ou en version internationale</p><pre><code class="lang-bash">node-atlas --browse --webconfig webconfig.en-us.json
</code></pre><p>Vous trouverrez tout ce qu'il faut pour appréhender la partie serveur du <code>constrollers/common.js</code> sur <a href="https://ssr.vuejs.org/">https://ssr.vuejs.org/</a> et seul la partie cliente du <code>assets/javascripts/common.js</code> sur <a href="https://vuejs.org/">https://vuejs.org/</a>.</p><div><div class="before">
							<a href="partie-outils.html">◄ Partie outils</a>
						</div><div class="after">
							<a href="anatomie-du-webconfig.html">Anatomie du webconfig ►</a>
						</div></div>
				</div>
			</div>
		</div>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		
		<script id="channel" data-channel="NodeAtlas/Aide" data-label="Chat d'Aide" src="javascripts/common.min.js"></script>
		
		<script src="https://buttons.github.io/buttons.js"></script>
	
</body></html>