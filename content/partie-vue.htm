<h2 id="partie-vue">Partie vue</h2><p>NodeAtlas fonctionne avec une configuration via l'utilisation d'un <code>webconfig.json</code> qui lui permet d'étendre les possibilités du site de manière évolutive tout au long de sa vie. Par exemple, pour créer un site sans JavaScript côté serveur (pas de contrôleur), il suffit de ne renseigner qu'un paramètre <code>view</code> pour chaque route.</p><p>Cependant, vous pourrez toujours utiliser du JavaScript dans les templates des vues grâce à l'utilisation du moteur de template <a href="http://ejs.co/">EJS</a> avec lequel fonctionne NodeAtlas par défaut.</p><p>Voyons les possibilités de nos sites par agrégat simple de fichiers de vue.</p><h3 id="routage">Routage</h3><p>Pour afficher le contenu d'un fichier derrière une URL, nous allons abonner au <code>webconfig.json</code> un certain nombre de fichier. Les adresses d'accès de ses fichiers sont appelés des routes et le contenu à ces routes est appelé une page.</p><h4 id="plusieurs-pages">Plusieurs pages</h4><p>Ci-dessous un exemple de configuration du <code>webconfig.json</code> pour plusieurs pages.</p><pre><code class="lang-json">{
    "viewsRelativePath": "views",
    "routes": {
        "/": {
            "view": "index.htm"
        },
        "/membre.html": {
            "view": "member.htm",
            "post": false
        },
        "/membre-sans-extension/": {
            "view": "member.htm",
            "get": false
        },
        "a-propos.html": {
            "view": "about.htm"
        },
        "/erreur.html": {
            "view": "error.htm",
            "statusCode": 404,
            "mimeType": "text/plain"
        }
    }
}
</code></pre><p>Pour faire tourner cet ensemble de fichier :</p><pre><code class="lang-txt">├─ views/
│  ├─ about.htm
│  ├─ error.htm
│  ├─ index.htm
│  └─ member.htm
└─ webconfig.json
</code></pre><p>aux adresses :</p><ul>
<li><code>http://localhost/</code> (répond à la racine),</li>
<li><code>http://localhost/membre.html</code> (ne répondra pas si demandée en POST),</li>
<li><code>http://localhost/membre-sans-extension/</code> (ne répondra pas si demandée en GET),</li>
<li><code>http://localhost/a-propos.html</code> (renvoi « Cannot GET about.html » car le contenu d'une route doit <strong>obligatoirement</strong> commencer par un <code>/</code> pour être référencée),</li>
<li><code>http://localhost/erreur.html</code> (renvoi du contenu plein texte (sans balise) avec une erreur 404).</li>
</ul><p><em>Note : si</em> <code>viewsRelativePath</code> <em>n'est pas présent dans <code>webconfig.json</code>, par défaut le dossier des vues est bien</em> <code>views</code>. <code>viewsRelativePath</code> <em>est donc utile seulement pour changer le nom / chemin du répertoire.</em></p><h4 id="raccourci-de-route">Raccourci de route</h4><p>La configuration ci-dessous est équivalente à la configuration de la section juste au-dessus</p><pre><code class="lang-json">{
    "viewsRelativePath": "views",
    "routes": {
        "/": "index.htm",
        "/membre.html": {
            "view": "member.htm",
            "post": false
        },
        "/membre-sans-extension/": {
            "view": "member.htm",
            "get": false
        },
        "a-propos.html": "about.htm",
        "/erreur.html": {
            "view": "error.htm",
            "statusCode": 404,
            "mimeType": "text/plain"
        }
    }
}
</code></pre><p>car</p><pre><code class="lang-json">"/": "index.htm",
</code></pre><p>est un raccourci de</p><pre><code class="lang-json">"/": {
    "view": "index.htm"
}
</code></pre><p>Évidemment ce raccourci ne sert que si <code>view</code> est le seul paramètre à déclarer de la route.</p><h4 id="ordonner-les-routes">Ordonner les routes</h4><p>Il est également possible de placer ses routes dans un tableau, ce qui permettra de les prioriser lors de leur manipulation ultérieure dans la section des contrôleurs.</p><p>Dans ce cas le chemin devient le paramètre <code>url</code>.</p><pre><code class="lang-json">{
    "viewsRelativePath": "views",
    "routes": [{
        "url": "/",
        "view": "index.htm"
    }, {
        "url": "/membre.html",
        "view": "member.htm",
        "post": false
    }, {
        "url": "/membre-sans-extension/",
        "view": "member.htm",
        "get": false
    }, {
        "url": "a-propos.html",
        "view": "about.htm"
    }, {
        "url": "/erreur.html",
        "view": "error.htm",
        "statusCode": 404,
        "mimeType": "text/plain"
    }]
}
</code></pre><h4 id="routage-dans-un-fichier-partag-">Routage dans un fichier partagé</h4><p>Afin de ne pas réécrire une longue liste de route dans un fichier <code>webconfig.json</code> à destination de votre environnement de développement et <code>webconfig.prod.json</code> à destination de votre environnement de production, vous pouvez mutualiser la déclaration des routes dans un fichier de votre choix. Par convention, c'est le fichier <code>routes.json</code>.</p><p>Par exemple :</p><p>L'ensemble de fichier suivant</p><pre><code class="lang-txt">├─ views/
│  └─ index.htm
├─ webconfig.json
└─ webconfig.prod.json
</code></pre><p>avec <code>webconfig.json</code></p><pre><code class="lang-json">{
    "httpPort": 7777,
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>et avec <code>webconfig.prod.json</code></p><pre><code class="lang-json">{
    "httpPort": 7776,
    "httpHostname": "blog.lesieur.name",
    "urlPort": 80,
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>pourrait devenir l'ensemble de fichier suivant</p><pre><code class="lang-txt">├─ views/
│  └─ index.htm
├─ routes.json
├─ webconfig.json
└─ webconfig.prod.json
</code></pre><p>avec <code>webconfig.json</code></p><pre><code class="lang-json">{
    "httpPort": 7777,
    "routes": "routes.json"
}
</code></pre><p>avec <code>webconfig.prod.json</code></p><pre><code class="lang-json">{
    "httpPort": 7776,
    "httpHostname": "blog.lesieur.name",
    "urlPort": 80,
    "routes": "routes.json"
}
</code></pre><p>et <code>routes.json</code></p><pre><code class="lang-json">{
    "/": {
        "view": "index.htm"
    }
}
</code></pre><p><em>Note : vous pouvez vous créer plusieurs fichiers de routes comme <code>routes.en.json</code> et <code>routes.fr.json</code> et associer chacun d'eux dans un ensemble de webconfig paramétrés pour faire tourner un site dans diverses langues.</em></p><h3 id="ressources">Ressources</h3><p>Vous pouvez héberger tout un tas de fichiers sur votre site dans un dossier public comme des images, polices, styles, scripts, etc. Par exemple avec cette configuration :</p><pre><code class="lang-json">{
    "assetsRelativePath": "assets",
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>et cet ensemble de fichiers :</p><pre><code class="lang-txt">├─ assets/
│  ├─ stylesheets/
│  │  └─ common.css
│  ├─ javascripts/
│  │  └─ common.js
│  └─ media/
│     └─ images/
│        └─ logo.png
├─ views/
│  └─ index.htm
└─ webconfig.json
</code></pre><p>vous aurez accès aux adresses :</p><ul>
<li><code>http://localhost/</code></li>
<li><code>http://localhost/stylesheets/common.css</code></li>
<li><code>http://localhost/javascripts/common.js</code></li>
<li><code>http://localhost/media/images/logo.png</code></li>
</ul><p><em>Note : si</em> <code>assetsRelativePath</code> <em>n'est pas présent dans <code>webconfig.json</code>, par défaut le dossier public est bien</em> <code>assets</code>. <code>assetsRelativePath</code> <em>est donc utile seulement pour changer le nom / chemin du répertoire.</em></p><h4 id="maxage-etag-etc-">maxAge, Etag, etc.</h4><p>Il est possible de délivrer des en-tête HTTP personnalisées pour les ressources publiques (comme le <code>maxAge</code>, l'<code>Etag</code>, etc.) via la propriété <code>staticOptions</code> du webconfig. Pour connaître la totalité des possibilités, voir les options d'<a href="http://expressjs.com/fr/api.html">Express</a>.</p><h3 id="composition">Composition</h3><p>Vous pouvez segmenter vos codes HTML afin de ne pas répéter le code redondant comme par exemple les parties « head » et « foot » ou tout autre fragment de code (pas d'inquiétude, nous verrons plus loin comment gérer un template unique composé des balises <code>head</code> et <code>body</code> avec fermeture dans le même fichier).</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "routes": {
        "/": {
            "view": "index.htm"
        },
        "/liste-des-membres/": {
            "view": "members.htm"
        }
    }
}
</code></pre><p>avec les fichiers suivants :</p><pre><code class="lang-txt">├─ assets/
│  ├─ stylesheets/
│  │  └─ common.css
│  └─ javascripts/
│     └─ common.js
├─ views/
│  ├─ partials/
│  │  ├─ head.htm
│  │  └─ foot.htm
│  ├─ index.htm
│  └─ members.htm
└─ webconfig.json
</code></pre><p><em>views/partials/head.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;Hello world&lt;/title&gt;
        &lt;link type="text/css" rel="stylesheet" href="stylesheets/common.css" media="all" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
</code></pre><p><em>views/partials/foot.htm</em></p><pre><code class="lang-html">        &lt;script async type="text/javascript" src="javascripts/common.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>views/index.htm</em></p><pre><code class="lang-html">    &lt;?- include("partials/head.htm") ?&gt;

    &lt;div&gt;
        &lt;h1&gt;Bienvenue&lt;/h1&gt;
        &lt;p&gt;C'est la page d'accueil.&lt;/p&gt;
    &lt;/div&gt;

    &lt;?- include("partials/foot.htm") ?&gt;
</code></pre><p><em>views/members.htm</em></p><pre><code class="lang-html">    &lt;?- include("partials/head.htm") ?&gt;

    &lt;div&gt;
        &lt;h1&gt;Liste des members&lt;/h1&gt;
        &lt;p&gt;C'est la page des membres.&lt;/p&gt;
    &lt;/div&gt;

    &lt;?- include("partials/foot.htm") ?&gt;
</code></pre><p>vous aurez accès aux adresses :</p><ul>
<li><code>http://localhost/</code></li>
<li><code>http://localhost/liste-des-membres/</code></li>
</ul><p><em>Note : pour plus d'information sur la différence entre <code>&lt;?</code>, <code>&lt;?-</code>, <code>&lt;?=</code>, etc. vous pouvez vous référez à la section <a href="#moteur-de-template-ejs">moteur de template</a>.</em></p><h3 id="variations">Variations</h3><p>Il est possible avec la même vue et les mêmes inclusions de générer des pages aux contenus différents (utile en mode génération de maquettes HTML). Activer les variations avec la configuration suivante :</p><pre><code class="lang-json">{
    "variation": "common.json",
    "variationsRelativePath": "variations",
    "routes": {
        "/": {
            "view": "template.htm",
            "variation": "index.json",
        },
        "/liste-des-membres/": {
            "view": "template.htm",
            "variation": "members.json",
        }
    }
}
</code></pre><p>avec les fichiers suivants :</p><pre><code class="lang-txt">├─ assets/
│  ├─ stylesheets/
│  │  ├─ common.css
│  │  ├─ index.css
│  │  └─ members.css
│  └─ javascripts/
│     ├─ common.js
│     ├─ index.js
│     └─ members.js
├─ variations/
│  ├─ common.json
│  ├─ index.json
│  └─ members.json
├─ views/
│  ├─ partials/
│  │  ├─ head.htm
│  │  └─ foot.htm
│  └─ template.htm
└─ webconfig.json
</code></pre><p><em>variations/common.json</em></p><pre><code class="lang-json">{
    "titleWebsite": "Titre du site",
    "classCssCommon": "common",
    "classJsCommon": "common"
}
</code></pre><p><em>variations/index.json</em></p><pre><code class="lang-json">{
    "titlePage": "Bienvenue",
    "classPage": "index",
    "content": "&lt;p&gt;C'est la page d'accueil.&lt;/p&gt;"
}
</code></pre><p><em>variations/members.json</em></p><pre><code class="lang-json">{
    "titlePage": "Liste des membres",
    "classPage": "members",
    "content": "&lt;p&gt;C'est la page des membres.&lt;/p&gt;"
}
</code></pre><p><em>views/partials/head.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;&lt;?- specific.titlePage ?&gt;&lt;/title&gt;

        &lt;link type="text/css" rel="stylesheet" href="stylesheets/&lt;?= common.classCssCommon ?&gt;.css" media="all" /&gt;
        &lt;link type="text/css" rel="stylesheet" href="stylesheets/&lt;?= specific.classPage ?&gt;.css" media="all" /&gt;
    &lt;/head&gt;
    &lt;body class="&lt;?= specific.classPage ?&gt;"&gt;
</code></pre><p><em>views/partials/foot.htm</em></p><pre><code class="lang-html">        &lt;script async type="text/javascript" src="javascripts/&lt;?= common.classJsCommon ?&gt;.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>views/template.htm</em></p><pre><code class="lang-html">    &lt;?- include("partials/head.htm") ?&gt;

    &lt;div class="title"&gt;&lt;?- common.titleWebsite ?&gt;&lt;/div&gt;

    &lt;div&gt;
        &lt;h1&gt;&lt;?- specific.titlePage ?&gt;&lt;/h1&gt;
        &lt;?- specific.content ?&gt;
    &lt;/div&gt;

    &lt;?- include("partials/foot.htm") ?&gt;
</code></pre><p>vous aurez accès aux adresses :</p><ul>
<li><code>http://localhost/</code></li>
<li><code>http://localhost/liste-des-membres/</code></li>
</ul><p><em>Note: si</em> <code>variationsRelativePath</code> <em>n'est pas présent dans <code>webconfig.json</code>, par défaut le dossier des variations est bien</em> <code>variations</code>. <code>variationsRelativePath</code> <em>est donc utile seulement pour changer le nom / chemin de répertoire.</em></p><h3 id="internationalisation-i18n">Internationalisation (i18n)</h3><h4 id="toutes-les-langues-sur-le-m-me-site">Toutes les langues sur le même site</h4><p>Sur le même principe, les variations peuvent être utilisées pour créer la même page, mais dans des langues différentes (et derrière des routes différentes) :</p><pre><code class="lang-json">{
    "languageCode": "en-us",
    "variationsRelativePath": "l10n",
    "routes": {
        "/": {
            "view": "landing.htm",
            "variation": "landing.json"
        },
        "/home/": {
            "view": "home.htm",
            "variation": "home.json"
        },
        "/accueil/": {
            "view": "home.htm",
            "variation": "home.json",
            "languageCode": "fr-fr"
        }
    }
}
</code></pre><p><em>Note : dans cet exemple, je n'utilise pas la propriété <code>variation</code> commune car je n'utilise pas de</em> <code>common.json</code> <em>. J'ai arbitrairement décidé de renommer mon dossier</em> <code>variations</code> <em>en</em> <code>l10n</code> <em>(localisation)</em>.</p><p>avec les fichiers suivants :</p><pre><code class="lang-txt">├─ l10n/
│  ├─ landing.json
│  ├─ en-us
│  │  └─ home.json
│  └─ fr-fr
│     └─ home.json
├─ views/
│  ├─ partials/
│  │  ├─ head.htm
│  │  └─ foot.htm
│  ├─ landing.htm
│  └─ home.htm
└─ webconfig.json
</code></pre><p><em>l10n/landing.json</em></p><pre><code class="lang-json">{
    "titlePage": "Landing",
    "classPage": "landing",
    "selectLabel": [
        "English",
        "Français"
    ]
}
</code></pre><p><em>l10n/en-us/home.json</em></p><pre><code class="lang-json">{
    "titlePage": "Welcome",
    "classPage": "home",
    "content": "&lt;p&gt;This is a home page.&lt;/p&gt;"
}
</code></pre><p><em>l10n/fr-fr/home.json</em></p><pre><code class="lang-json">{
    "titlePage": "Bienvenue",
    "classPage": "home",
    "content": "&lt;p&gt;C'est la page d'accueil.&lt;/p&gt;"
}
</code></pre><p><em>views/partials/head.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="&lt;?= languageCode ?&gt;"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;&lt;?= specific.titlePage ?&gt;&lt;/title&gt;
    &lt;/head&gt;
    &lt;body class="&lt;?= specific.classPage ?&gt;"&gt;
</code></pre><p><em>views/partials/foot.htm</em></p><pre><code class="lang-html">    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>views/landing.htm</em></p><pre><code class="lang-html">    &lt;?- include("partials/head.htm") ?&gt;

    &lt;select&gt;
        &lt;? for (var i = 0; i &lt; specific.selectLabel.length; i++) { ?&gt;
        &lt;option&gt;&lt;?= specific.selectLabel[i] ?&gt;&lt;/option&gt;
        &lt;? } ?&gt;
    &lt;/select&gt;

    &lt;?- include("partials/foot.htm") ?&gt;
</code></pre><p><em>views/home.htm</em></p><pre><code class="lang-html">    &lt;?- include("partials/head.htm") ?&gt;

    &lt;div&gt;
        &lt;h1&gt;&lt;?- specific.titlePage ?&gt;&lt;/h1&gt;
        &lt;?- specific.content ?&gt;
    &lt;/div&gt;

    &lt;?- include("partials/foot.htm") ?&gt;
</code></pre><p>vous aurez accès aux adresses :</p><ul>
<li><code>http://localhost/</code></li>
<li><code>http://localhost/home/</code></li>
<li><code>http://localhost/accueil/</code></li>
</ul><p><em>Note : par défaut c'est le</em> <code>languageCode</code> <em>racine qui conditionne la langue d'affichage du site. Il est aussi possible de changer la langue avec un</em> <code>languageCode</code> par page. <em>Il faut également savoir que dès que le site ou une page à un</em> <code>languageCode</code> <em>dans la configuration, ses fichiers de variations doivent être placées dans un sous répertoire portant le nom du</em> <code>languageCode</code>.</p><h4 id="utiliser-variations-et-localisations-ensemble">Utiliser variations et localisations ensemble</h4><p>Vous avez peut-être constaté dans l'exemple précédent que le fichier <code>landing.json</code> n'était pas dans le dossier <code>en-us/</code> ou <code>fr-fr/</code>. Cela est tout à fait possible et signifie qu'il sera utilisé dans les langues qui ne le possèdent pas dans leur dossier.</p><p>Aussi, quand un <code>languageCode</code> est précisé, NodeAtlas part d'abord chercher la valeur dans le fichier du dossier correspondant. Si celle-ci n'y est pas, alors il part la chercher dans le dossier parent (celui utilisé en standard pour les variations sans localisation).</p><p>Cela va vous permettre par exemple de gérer la langue maître directement dans le dossier de variation. Ainsi avec l'exemple suivant :</p><pre><code class="lang-txt">┊┉
├─ variations/
│  ├─ common.json
│  ├─ home.json
│  └─ fr-fr
│     ├─ common.json
│     └─ home.json
┊┉
</code></pre><p>vous pouvez :</p><ul>
<li>gérer la version <code>en-us</code> directement à la racine de <code>variations/</code> (comme NodeAtlas ne trouve rien dans <code>en-us</code> il utilise alors les valeurs des fichiers racines) et</li>
<li>gérer la version <code>fr-fr</code> dans le dossier <code>fr-fr/</code>,</li>
</ul><p>ainsi, si une phrase n'est pas encore traduite dans un fichier <code>fr-fr</code>, au lieu de renvoyer une erreur, NodeAtlas renverra la version racine, soit la version <code>en-us</code>.</p><h4 id="-chaque-langue-sa-configuration">À chaque langue sa configuration</h4><p>Vous pouvez également décider de faire tourner chaque langue dans un <code>webconfig.json</code> différent. Avec l'ensemble de fichier suivant :</p><pre><code class="lang-txt">├─ variations/
│  ├─ landing.json
│  ├─ en-us
│  │  ├─ home.json
│  │  └─ members.json
│  └─ fr-fr
│     ├─ home.json
│     └─ members.json
├─ views/
│  ├─ partials/
│  │  ├─ head.htm
│  │  └─ foot.htm
│  ├─ landing.htm
│  ├─ home.htm
│  └─ members.htm
├─ webconfig.json
├─ webconfig.en-us.json
└─ webconfig.fr-fr.json
</code></pre><p>vous pourriez avoir les <code>webconfig.json</code> suivant :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "routes": {
        "/": {
            "view": "landing.htm",
            "variation": "landing.json"
        }
    }
}
</code></pre><p><em>webconfig.en-us.json</em></p><pre><code class="lang-json">{
    "httpPort": 81,
    "urlRelativeSubPath": "english",
    "languageCode": "en-us",
    "routes": {
        "/": {
            "view": "home.htm",
            "variation": "home.json"
        },
        "/members-list/": {
            "view": "members.htm",
            "variation": "members.json"
        }
    }
}
</code></pre><p><em>webconfig.fr-fr.json</em></p><pre><code class="lang-json">{
    "httpPort": 82,
    "urlRelativeSubPath": "francais",
    "languageCode": "fr-fr",
    "routes": {
        "/": {
            "view": "home.htm",
            "variation": "home.json"
        },
        "/liste-des-membres/": {
            "view": "members.htm",
            "variation": "members.json"
        }
    }
}
</code></pre><p>et avoir accès aux adresses :</p><ul>
<li><code>http://localhost/</code></li>
<li><code>http://localhost:81/english/</code></li>
<li><code>http://localhost:81/english/</code></li>
<li><code>http://localhost:81/english/members-list/</code></li>
<li><code>http://localhost:82/francais/</code></li>
<li><code>http://localhost:82/francais/liste-des-membres/</code></li>
</ul><p>Il est ensuite possible de faire du reverse proxy avec pour ramener l'ensemble des URL sur le port 80 afin d'obtenir :</p><ul>
<li><code>http://www.website.ext/</code></li>
<li><code>http://www.website.ext/english/</code></li>
<li><code>http://www.website.ext/english/</code></li>
<li><code>http://www.website.ext/english/members-list/</code></li>
<li><code>http://www.website.ext/francais/</code></li>
<li><code>http://www.website.ext/francais/liste-des-membres/</code></li>
</ul><h3 id="valeurs-d-url">Valeurs d'URL</h3><p>Par défaut, si vous utilisez la configuration suivante :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>avec la vue suivante :</p><p><em>views/index.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;URL&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;&lt;?- urlRootPath ?&gt;&lt;/div&gt;
        &lt;div&gt;&lt;?- urlSubPath ?&gt;&lt;/div&gt;
        &lt;div&gt;&lt;?- urlBasePath ?&gt;&lt;/div&gt;
        &lt;div&gt;&lt;?- urlFilePath ?&gt;&lt;/div&gt;
        &lt;div&gt;&lt;?- urlQueryPath ?&gt;&lt;/div&gt;
        &lt;div&gt;&lt;?- urlPath ?&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>cela est identique à utiliser celle-ci :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "httpHostname": "localhost",
    "httpPort": 80,
    "httpSecure": false,
    "urlRelativeSubPath": "",
    "routes": {
        "/": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>Vous pourrez accéder à l'URL : <code>http://localhost/</code> et au contenu :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;URL&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;http://localhost&lt;/div&gt;
        &lt;div&gt;&lt;/div&gt;
        &lt;div&gt;http://localhost&lt;/div&gt;
        &lt;div&gt;/&lt;/div&gt;
        &lt;div&gt;&lt;/div&gt;
        &lt;div&gt;http://localhost/&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Changez alors la configuration en ceci :</p><pre><code class="lang-json">{
    "httpHostname": "127.0.0.1",
    "httpPort": 7777,
    "httpSecure": "security/server",
    "urlRelativeSubPath": "sub/folder",
    "routes": {
        "/index.html": {
            "view": "index.htm"
        }
    }
}
</code></pre><p>Vous pourrez cette fois accéder à l'URL : <code>https://127.0.0.1:7777/sub/folder/index.html?test=ok</code> et au contenu :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;URL&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;https://127.0.0.1:7777&lt;/div&gt;
        &lt;div&gt;/sub/folder&lt;/div&gt;
        &lt;div&gt;https://127.0.0.1:7777/sub/folder&lt;/div&gt;
        &lt;div&gt;/index.html&lt;/div&gt;
        &lt;div&gt;?test=ok&lt;/div&gt;
        &lt;div&gt;https://127.0.0.1:7777/sub/folder/index.html&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Note : cette exemple ne fonctionnera que si vous avez des fichiers <code>server.crt</code> et <code>server.key</code> valide dans le dossier <code>security/</code>. Essayez le sans <code>"httpSecure": "security/server"</code> et il fonctionnera avec des URL sans <code>https</code>.</p><h3 id="variables-de-webconfig">Variables de webconfig</h3><p>Imaginons deux webconfigs dans lesquels nous allons créer nos propres variables comme suit :</p><ol>
<li><p><em>webconfig.json</em></p>
<pre><code class="lang-json">{
    "routes": {
        "/": {
            "view": "index.htm"
        }
    },
    "_minified": ""
}
</code></pre>
</li>
<li><p><em>webconfig.prod.json</em></p>
<pre><code class="lang-json">{
    "routes": {
        "/": {
            "view": "index.htm"
        }
    },
    "_minified": ".min"
}
</code></pre>
</li>
</ol><p>avec cet ensemble de fichiers :</p><pre><code class="lang-txt">├─ assets/
│  ├─ stylesheets/
│  │  ├─ common.css
│  │  └─ common.min.css
│  └─ javascripts/
│     ├─ common.js
│     └─ common.min.js
├─ views/
│  └─ index.htm
├─ webconfig.json
└─ webconfig.prod.json
</code></pre><p>et <code>index.htm</code> contenant :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;Hello world&lt;/title&gt;
        &lt;link rel="stylesheet" type="text/css" href="stylesheets/common&lt;?= webconfig._minified ?&gt;.css" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;Ceci est un test de récupération de ressources minifiées/non-minifiées.&lt;/div&gt;
        &lt;script type="text/javascript" src="javascripts/common&lt;?= webconfig._minified ?&gt;.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>En lançant (depuis le dossier du site) la commande :</p><pre><code class="lang-bash">$ node-atlas
</code></pre><p>Nous aurons à l'adresse <code>http://localhost/</code> la sortie suivante avec les fichiers non minifiés :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;Hello world&lt;/title&gt;
        &lt;link rel="stylesheet" type="text/css" href="stylesheets/common.css" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;Ceci est un test de récupération de ressources minifiées/non-minifiées.&lt;/div&gt;
        &lt;script type="text/javascript" src="javascripts/common.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Cependant en lançant la commande :</p><pre><code class="lang-bash">$ node-atlas --webconfig webconfig.prod.json
</code></pre><p>Nous aurons à l'adresse <code>http://localhost/</code> la sortie suivante avec les fichiers minifiés :</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;Hello world&lt;/title&gt;
        &lt;link rel="stylesheet" type="text/css" href="stylesheets/common.min.css" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;Ceci est un test de récupération de ressources minifiées/non-minifiées.&lt;/div&gt;
        &lt;script type="text/javascript" src="javascripts/common.min.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>Note : il vaut mieux préfixer ses variables personnelles avec « _ » pour éviter des conflits avec des variables de configuration existantes ou futures.</em></p><h3 id="mise-en-page">Mise en page</h3><p>Plutôt que d'inclure une partie header et une partie footer en deux fichiers scindés dont les balises de l'un ne se ferme que dans les balises de l'autre : vous pouvez également les rassembler dans un seul fichier dans lequel vous indiquerez à quelle endroit les vues doivent se placer. Vous pourrez dans ce layout utiliser toutes les variations et tous les systèmes déjà vu.</p><p>avec cet ensemble de fichiers</p><pre><code class="lang-txt">├─ assets/
│  ├─ stylesheets/
│  │  ├─ common.css
│  │  └─ index.css
│  └─ javascripts/
│     └─ common.js
├─ variations/
│  ├─ common.json
│  └─ index.json
├─ views/
│  ├─ partials/
│  │  └─ header.htm
│  ├─ about.htm
│  ├─ common.htm
│  └─ index.htm
└─ webconfig.json
</code></pre><p>et avec le webconfig suivant :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "view": "common.htm",
    "variation": "common.json",
    "routes": {
        "/": {
            "view": "index.htm",
            "variation": "index.json"
        },
        "/a-propos/": {
            "view": "about.htm"
        }
    }
}
</code></pre><p>et ces deux fichiers de variations :</p><p><em>common.json</em></p><pre><code class="lang-json">{
    "titleWebsite": "Titre du site",
    "classCssCommon": "common",
    "classJsCommon": "common"
}
</code></pre><p><em>index.json</em></p><pre><code class="lang-json">{
    "titlePage": "Bienvenue",
    "classPage": "index",
    "content": "&lt;p&gt;C'est la page d'accueil.&lt;/p&gt;"
}
</code></pre><p>vous pourez générer avec ces vues :</p><p><em>views/common.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;title&gt;&lt;?- specific.titlePage || "Pas de titre" ?&gt;&lt;/title&gt;
        &lt;link rel="stylesheet" href="stylesheets/&lt;?= common.classCssCommon ?&gt;.css"  media="all"&gt;
        &lt;? if (specific.classPage) { ?&gt;
        &lt;link rel="stylesheet" href="stylesheets/&lt;?= specific.classPage ?&gt;.css"  media="all"&gt;
        &lt;? } ?&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;!-- Inclure un fichier normalement --&gt;
        &lt;?- include("partials/header.htm") ?&gt;

        &lt;!-- Inclure le fichier vu de `view` --&gt;
        &lt;?- include(routeParameters.view) ?&gt;

        &lt;script async="true" type="text/javascript" src="javascripts/&lt;?= common.classJsCommon ?&gt;.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>views/partals/header.htm</em></p><pre><code class="lang-html">    &lt;? if (specific.titlePage) { ?&gt;
    &lt;header&gt;
        &lt;h1&gt;&lt;?= specific.titlePage ?&gt;&lt;/h1&gt;
    &lt;/header&gt;
    &lt;? } ?&gt;
</code></pre><p><em>views/index.htm</em></p><pre><code class="lang-html">    &lt;div&gt;
        &lt;?- specific.content ?&gt;
    &lt;/div&gt;
</code></pre><p><em>views/about.htm</em></p><pre><code class="lang-html">    &lt;div&gt;
        &lt;h1&gt;NodeAtlas © Haeresis&lt;/h1&gt;
    &lt;/div&gt;
</code></pre><p>et obtenir les URL suivantes :</p><p><em>/</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;title&gt;Bienvenue&lt;/title&gt;
        &lt;link rel="stylesheet" href="stylesheets/common.css"  media="all"&gt;
        &lt;link rel="stylesheet" href="stylesheets/index.css"  media="all"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;header&gt;
            &lt;h1&gt;Bienvenue&lt;/h1&gt;
        &lt;/header&gt;
        &lt;div&gt;
            &lt;p&gt;C'est la page d'accueil.&lt;/p&gt;
        &lt;/div&gt;
        &lt;script async="true" type="text/javascript" src="javascripts/common.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>/about/</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;title&gt;Pas de titre&lt;/title&gt;
        &lt;link rel="stylesheet" href="stylesheets/common.css"  media="all"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div&gt;
            &lt;h1&gt;NodeAtlas © Haeresis&lt;/h1&gt;
        &lt;/div&gt;
        &lt;script async="true" type="text/javascript" src="javascripts/common.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="fichiers-partages">Fichiers partagés</h3><p>Il est possible de partager plus de contenu que ce qu'il y a dans le dossier hébergé par <code>assetsRelativePath</code>. Il est tout à fait possible de partager des vues ou des modèles avec la partie cliente par exemple. On appel les fichiers de ses dossiers des fichiers statiques.</p><p>Voyons l'exemple suivant :</p><p>avec cet ensemble de fichiers</p><pre><code class="lang-txt">├─ models/
│  └─ user.js
├─ views/
│  └─ index.htm
└─ webconfig.json
</code></pre><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "statics": {
        "/javascripts/models": "models"
    },
    "routes": {
        "/": "index.htm"
    }
}
</code></pre><p><em>views/index.htm</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
    &lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;title&gt;Statics&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="user"&gt;&lt;/div&gt;
        &lt;script src="javascripts/models/user.js"&gt;&lt;/script&gt;
        &lt;script&gt;
            var user = new User(),
                mount = document.getElementById("user");

            user
                .firstname("Bruno")
                .lastname("Lesieur");

            mount.innerHTML = user.firstname() + " " + user.lastname();
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>models/user.js</em></p><pre><code class="lang-js">(function (expose, factory) {
    if (typeof module !== 'undefined' &amp;&amp; module.exports) {
        module.exports = factory;
    } else {
        expose.User = factory;
    }
}(this, function User() {
    var privates = {},
        publics = this;

    publics.lastname = function (lastname) {
        if (typeof lastname === 'undefined') {
            return privates.lastname;
        } else {
            privates.lastname = lastname;
            return publics;
        }
    };

    publics.firstname = function (firstname) {
        if (typeof firstname === 'undefined') {
            return privates.firstname;
        } else {
            privates.firstname = firstname;
            return publics;
        }
    };
}));
</code></pre><p>Nous pourrons accéder aux fichiers HTML <code>http://localhost/</code> et au JavaScript <code>http://localhost/javascripts/user.js</code>.</p><h4 id="maxage-etag-etc-">maxAge, Etag, etc.</h4><p>Il est possible de configurer les informations livrées par NodeAtlas à la demande d'une ressource statique (comme le <code>maxAge</code>, l'<code>Etag</code>, etc.) via la propriété <code>staticOptions</code>. Dans ce cas, on ne fournit plus une <code>string</code> mais un <code>Object</code> et la propriété initiale devient le paramètre <code>path</code>. Par défaut les <code>staticOptions</code> sont celle global au webconfig (voir les options d'<a href="http://expressjs.com/fr/api.html">Express</a>).</p><pre><code class="lang-json">{
    "statics": {
        "/javascripts/models": {
            "path": "models",
            "staticOptions": {
                "index": false
            }
        }
    },
    "routes": {
        "/": "index.htm"
    }
}
</code></pre><h4 id="ordonner-les-routes">Ordonner les routes</h4><p>Il est également possible de placer ses routes dans un tableau, ce qui permettra de les prioriser lors de leur manipulation ultérieur dans la section des contrôleurs.</p><p>Dans ce cas le chemin devient le paramètre <code>virtual</code>.</p><pre><code class="lang-json">{
    "statics": [{
        "virtual": "/javascripts/models",
        "path": "models",
        "staticOptions": {
            "index": false
        }
    }],
    "routes": {
        "/": "index.htm"
    }
}
</code></pre><h3 id="maquettes-statiques-generees">Maquettes statiques générées</h3><h4 id="g-n-rer-des-designs-html">Générer des designs HTML</h4><p>Avec la configuration suivante il est possible de générer des aperçu HTML du rendu de chaque page dans un fichier associé. Le fichier sera (re)créé à chaque affichage de la page dans votre navigateur.</p><pre><code class="lang-json">{
    "htmlGenerationBeforeResponse": true,
    "assetsRelativePath": "../HTML/",
    "serverlessRelativePath": "../HTML/",
    "routes": {
        "/": {
            "view": "index.htm",
            "output": "/index.html"
        },
        "/liste-des-membres/": {
            "view": "members.htm",
            "output": "/membres/liste.html"
        },
        "/liste-des-membres/?foo=bar": {
            "view": "members.htm",
            "output": false
        },
        "/aucun/parametre/output/": {
            "view": "members.htm"
        }
    }
}
</code></pre><p>et l'ensemble de fichiers suivant :</p><pre><code class="lang-txt">├─ HTML/
│  ├─ stylesheets/
│  │  ├─ common.css
│  └─ javascripts/
│     └─ common.js
├─ views/
│  ├─ index.htm
│  └─ members.htm
└─ webconfig.json
</code></pre><p>on peut créer physiquement la sortie suivante :</p><pre><code class="lang-txt">├─ HTML/
│  ├─ stylesheets/
│  │  └─ common.css
│  ├─ javascripts/
│  │  └─ common.js
│  ├─ index.html
│  ├─ members/
│  │  └─ list.html
│  └─ aucun/
│     └─ parametre/
│        └─ output ⤆ Ceci est un fichier
├─ views/
│  ┊┉
└─ webconfig.json
</code></pre><p>en se rendant aux adresses :</p><ul>
<li><code>http://localhost/</code></li>
<li><code>http://localhost/liste-des-membres/</code></li>
<li><code>http://localhost/parametre/output/</code></li>
</ul><p><em>Note : Il n'y a pas de génération pour <code>/liste-des-membres/?foo=bar</code> car <code>output</code> est à <code>false</code>. Utilisez cette valeur pour ignorer des routes à la génération.</em></p><p>La génération s'enclenche quand on affiche la page uniquement parce que <code>htmlGenerationBeforeResponse</code> existe et est à <code>true</code>.</p><h4 id="g-n-rer-un-site-sans-partie-serveur">Générer un site sans partie serveur</h4><p>Il est également possible de gérer la création d'un site en simple page HTML avec la commande <code>--generate</code>.</p><p>Si <code>htmlGenerationBeforeResponse</code> est passé à <code>false</code> (ou enlevé) le seul moyen de générer toutes les pages du site sera via la commande <code>node-atlas --generate</code> qui génèrera toutes les pages d'un coup dans le dossier <code>serverlessRelativePath</code> à la condition que le <code>output</code> global soit à <code>true</code>.</p><p>De plus avec <code>--generate</code>, l'intégralité du dossier <code>assetsRelativePath</code> (dossier des fichiers publics) sera copié dans le dossier <code>serverlessRelativePath</code> si les deux dossiers n'ont pas un chemin identique à condition que <code>assetsCopy</code> soit à <code>true</code>.</p><p>Cela vous permet réellement d'obtenir en sortie dans le dossier de génération des pages « stand-alone » avec l'intégralité des fichiers auxquels elles font appel (CSS / JS / Images, etc.).</p><p>Voyons cela avec la configuration suivante :</p><pre><code class="lang-json">{
    "output": true,
    "assetsCopy": true,
    "languageCode": "fr-fr",
    "index": true,
    "serverlessRelativePath": "serverless",
    "routes": {
        "/cv.html": {
            "view": "index.htm",
            "variation": "index.json"
        },
        "/en/cv.html": {
            "view": "index.htm",
            "variation": "index.json",
            "languageCode": "en"
        }
    }
}
</code></pre><p>et l'ensemble de fichiers suivant :</p><pre><code class="lang-txt">├─ assets/
│  ├─ stylesheets/
│  │  └─ common.css
│  └─ javascripts/
│     └─ common.js
├─ variations/
│  ├─ fr-fr/
│  │  └─ index.json
│  └─ en/
│     └─ index.json
├─ views/
│  └─ index.htm
└─ webconfig.json
</code></pre><p>Avec <code>node-atlas --browse</code>, à l'adresse <code>http://localhost/</code> s'affichera la liste des pages composants votre site (grâce à <code>"index": true</code>).</p><p>Il ne restera plus qu'à, une fois <code>--generate</code> utilisé, admirer votre site HTML dans le dossier :</p><pre><code>┊┉
├─ serverless/
│  ├─ stylesheets/
│  │  └─ common.css
│  ├─ javascripts/
│  │  └─ common.js
│  ├─ cv.html
│  └─ en/
│     └─ cv.html
┊┉
</code></pre><p><em>Note : si</em> <code>serverlessRelativePath</code> <em>n'est pas présent dans <code>webconfig.js</code>, par défaut le dossier des générations est bien</em> <code>serverless/</code>. <code>serverlessRelativePath</code> <em>est donc utile seulement pour changer le nom / chemin répertoire.</em></p><h4 id="g-n-rer-les-fichiers-statics">Générer les fichiers statics</h4><p>Les fichiers définis dans <code>statics</code> sont également copiable dans le dossier <code>serverlessRelativePath</code> lors de l'appel à <code>--generate</code>. Pour permettre cela, vous pouvez utiliser pour chaque dossier statique le paramètre <code>output</code> mis à <code>true</code>.</p><pre><code>{
    "statics": {
        "/javascripts/models": {
            "path": "models",
            "output": true
        }
    },
}
</code></pre><h3 id="moteurs-de-template">Moteurs de template</h3><p>Par défaut, NodeAtlas utilise déjà le <a href="http://ejs.co/">moteur de template EJS</a>, c'est ce qui vous permet d'utiliser du JavaScript dans les balises <code>&lt;?</code> et <code>?&gt;</code>.</p><p>Les balises <code>&lt;?</code> et <code>?&gt;</code> permettent d'inclure du JavaScript au sein même de vos templates. Il existe différentes variantes de la balise vous permettant d'afficher le résultat JavaScript dans votre template (comme vous le feriez avec un <code>document.write</code>). Les voici :</p><ul>
<li><code>&lt;?</code> La balise « Scriptlet » par défaut, pour les structure de contrôle, pas de sortie.</li>
<li><code>&lt;?=</code> Affiché le résultat des expressions dans le template (échappement HTML).</li>
<li><code>&lt;?-</code> Affiché le résultat des expressions dans le template tel quel.</li>
<li><code>&lt;?#</code> Balise commentaire, pas d'exécution, pas de sortie.</li>
<li><code>&lt;?%</code> Affiche litéralement le contenu d'une <code>&lt;?</code></li>
<li><code>?&gt;</code> La balise de fermeture.</li>
<li><code>-?&gt;</code> La balise Mode trim, exécute un trim sur les nouvelles lignes.</li>
</ul><h4 id="ejs">EJS</h4><p>Cependant, EJS fonctionne normalement avec les balises <code>&lt;%</code> et <code>%&gt;</code>. Vous pouvez remettre ces valeurs ou même utiliser celles que vous souhaitez.</p><pre><code class="lang-json">{
    "templateEngineDelimiter": "%",
    "routes": {
        "/": {
            "view": "index.ejs"
        }
    }
}
</code></pre><p>Par exemple, pour inclure une partie de fichier on utilise l'instruction <code>&lt;?- include("partials/head.htm") ?&gt;</code>. Il serait possible de le faire avec <code>&lt;%- include("partials/head") %&gt;</code> avec la configuration ci-dessous :</p><p>Voyez l'exemple dans les fichiers ci-dessous :</p><p><em>webconfig.json</em></p><pre><code class="lang-json">{
    "templateEngineDelimiter": "%",
    "variation": "common.json",
    "routes": {
        "/": {
            "view": "index.ejs",
            "variation": "index.json"
        }
    }
}
</code></pre><p><em>variations/common.json</em></p><pre><code class="lang-json">{
    "titleWebsite": "Titre du site",
    "classCssCommon": "common",
    "classJsCommon": "common"
}
</code></pre><p><em>variations/index.json</em></p><pre><code class="lang-json">{
    "titlePage": "Bienvenue",
    "classPage": "index",
    "content": "&lt;p&gt;C'est la page d'accueil.&lt;/p&gt;"
}
</code></pre><p><em>views/partials/head.ejs</em></p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr-fr"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;&lt;%- specific.titlePage %&gt;&lt;/title&gt;
        &lt;link type="text/css" rel="stylesheet" href="stylesheets/&lt;%= common.classCssCommon %&gt;.css" media="all" /&gt;
        &lt;link type="text/css" rel="stylesheet" href="stylesheets/&lt;%= specific.classPage %&gt;.css" media="all" /&gt;
    &lt;/head&gt;
    &lt;body class="&lt;%= specific.classPage %&gt;"&gt;
</code></pre><p><em>views/partials/foot.ejs</em></p><pre><code class="lang-html">        &lt;script async type="text/javascript" src="javascripts/&lt;%= common.classJsCommon %&gt;.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>views/index.ejs</em></p><pre><code class="lang-html">    &lt;%- include("partials/head") %&gt;

    &lt;div class="title"&gt;&lt;%- common.titleWebsite %&gt;&lt;/div&gt;

    &lt;div&gt;
        &lt;h1&gt;&lt;%- specific.titlePage %&gt;&lt;/h1&gt;
        &lt;%- specific.content %&gt;
    &lt;/div&gt;

    &lt;%- include("partials/foot") %&gt;
</code></pre><p>Pour tout savoir sur les possibilités du moteur de template consultez <a href="http://ejs.co/">la documentation EJS</a>.</p><p><em>Note : si rien n'est précisé,</em> <code>templateEngineDelimiter</code> <em>vaut</em> <code>?</code>.</p><h4 id="pug">Pug</h4><p>Il est possible d'utiliser en lieu et place de EJS le <a href="https://pugjs.org/">moteur de template Pug</a> (anciennement Jade) pour générer les pages et manipuler les variations. Cela est possible pour l'intégralité du site avec par exemple ce webconfig :</p><pre><code class="lang-json">{
    "pug": true,
    "routes": {
        "/": {
            "view": "index.pug"
        },
        "/contenu/": {
            "view": "content.pug"
        }
    }
}
</code></pre><p>ou seulement pour une page précise :</p><pre><code>{
    "routes": {
        "/": {
            "view": "index.pug"
        },
        "/contenu/": {
            "pug": true,
            "view": "content.pug"
        }
    }
}
</code></pre><p>Il est également possible pour un moteur complet en Pug de repasser une page spécifique en EJS.</p><pre><code>{
    "pug": true,
    "routes": {
        "/": {
            "pug": false,
            "view": "index.pug"
        },
        "/contenu/": {
            "view": "content.pug"
        }
    }
}
</code></pre><p>Voyons ce que cela donnerait avec l'exemple suivant :</p><p><em>webconfig.json</em></p><pre><code>{
    "pug": true,
    "view": "common.pug",
    "variation": "common.json",
    "routes": {
        "/": {
            "view": "index.pug",
            "variation": "index.json"
        }
    }
}
</code></pre><p><em>variations/common.json</em></p><pre><code class="lang-json">{
    "titleWebsite": "Titre du site",
    "classCssCommon": "common",
    "classJsCommon": "common"
}
</code></pre><p><em>variations/index.json</em></p><pre><code class="lang-json">{
    "titlePage": "Bienvenue",
    "classPage": "index",
    "content": "&lt;p&gt;C'est la page d'accueil.&lt;/p&gt;"
}
</code></pre><p><em>views/common.pug</em></p><pre><code class="lang-html">doctype html
html(lang="fr-fr")
    head
        meta(charset="utf-8")
        title #{specific.titlePage}
        link(type="text/css", rel="stylesheet", href="stylesheets/" + common.classCssCommon + ".css", media="all")
        link(type="text/css", rel="stylesheet", href="stylesheets/" + specific.classPage + ".css", media="all")
    body(class=specific.classPage)
        include partials/header
        include #{routeParameters.view}
        script(async, type="text/javascript", src="javascripts/" + common.classJsCommon + ".js")
</code></pre><p><em>views/partials/header.pug</em></p><pre><code class="lang-html">h1 #{titleWebsite}
</code></pre><p><em>views/index.pug</em></p><pre><code class="lang-html">div
    h2 #{specific.titlePage}
    | !{specific.content}
</code></pre><p>Pour tout savoir sur les possibilités du moteur de template consultez <a href="https://pugjs.org/">la documentation Pug</a>.</p><p><em>Note : si rien n'est précisé,</em> <code>pug</code> <em>vaut</em> <code>false</code>.</p><h4 id="vue">Vue</h4><p><a href="https://vuejs.org/">Vue</a> est un framework MVVM évolutif comme Angular ou React qui est utilisable en tant que moteur de rendu côté serveur pour NodeAtlas. L'avantage ici, c'est que côté client il reprend la main en hydratant le code généré depuis le serveur pour le rendre réactif côté client !</p><blockquote>
<p>N'hésitez pas à reconsulter cette partie plus tard car elle utilise divers mécanismes de contrôleur que nous allons apprendre à utiliser dans la prochaine partie.</p>
</blockquote><p>Nous vous proposons de mettre en place l'utilisation de <a href="https://fr.vuejs.org/">Vue</a> + <a href="https://router.vuejs.org/fr/">Vue Router</a> + <a href="https://ssr.vuejs.org/fr/">Vue Server Renderer</a> à travers la commande suivante :</p><pre><code class="lang-bash">node-atlas --create hello-vue
</code></pre><p>puis de l'initialiser à l'aide de la commande</p><pre><code class="lang-bash">cd ./hello-vue/
npm install
</code></pre><p>et enfin de le démarrer avec la commande</p><pre><code class="lang-bash">node-atlas --browse
</code></pre><ul>
<li><a href="https://github.com/Haeresis/node-atlas-hello-vue">Retrouvez les sources et toutes les explications d'utilisation sur le dépôt GitHub dédié</a>.</li>
</ul><div><div class="before">
							<a href="introduction.html">◄ Introduction</a>
						</div><div class="after">
							<a href="partie-controleur.html">Partie contrôleur ►</a>
						</div></div>